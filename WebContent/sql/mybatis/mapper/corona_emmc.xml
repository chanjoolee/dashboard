<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="">

	<select id="dashboard.corona.emmc.summary" resultType="hashmap">
	
		with tbl_data as (
			select
				m.SAMPLE,
				m.FIRMWARE,
				m.CATEGORY,
				m.TEST_ITEM,
				count(*) total_count,
				count(case when m.status = 'PASS' then 1 else null end) pass_count,
				count(case when m.status = 'FAIL' then 1 else null end) fail_count
			from CORONA_EMMC_F_S_MAP m 
			join CORONA_EMMC_FIRMWARE_MASTER f
				on f.firmware = m.firmware
				and f.sample = m.sample
			where 1=1		
			--and m.FIRMWARE = 'U3AE351C5419'
			--and m.SAMPLE = 'Armstrong3D_S36_128Gb_32GB'
			and m.FIRMWARE = #{firmware}
			and m.SAMPLE = #{sample}
			group by 
				m.FIRMWARE,
				m.SAMPLE,
				m.CATEGORY,
				m.TEST_ITEM
			--order by m.CATEGORY,m.TEST_ITEM
		)	,
		tbl_order as (
			select 'Protocol' CATEGORY , 1 as seq from dual  union all
			select 'Functional Test' CATEGORY , 2 as seq from dual  union all
			select 'Write Stress' CATEGORY , 3 as seq from dual  union all
			select 'Read Stress' CATEGORY , 4 as seq from dual  union all
			select 'SPOR Test' CATEGORY , 5 as seq from dual  union all
			select 'Lesson Learn' CATEGORY , 6 as seq from dual  		
		)	
		select 
			a.FIRMWARE,
			a.SAMPLE,
			a.CATEGORY,
			a.TEST_ITEM,
			a.TOTAL_COUNT,
			a.PASS_COUNT,		
			c.WEIGHT,
			c.COMPUTE_CRETERIA,
			--nvl(c.COMPUTE_CRETERIA,'None') COMPUTE_CRETERIA,
			c.COMPUTE_VALUE,
			c.TEST_STATE as "testState" ,
			case 
				when c.COMPUTE_CRETERIA = 'hrs' Then 96
				when c.COMPUTE_CRETERIA = 'sec' Then 86400
				when c.COMPUTE_CRETERIA = 'step' Then 868
				when c.COMPUTE_CRETERIA = 'min' Then 10000
				else null
			end as max_value,
			a.FAIL_COUNT
		from tbl_data  a
		left outer join tbl_order b
			 on a.CATEGORY = b.CATEGORY
		left outer join CORONA_EMMC_TESTITEM_MASTER c
			on c.FIRMWARE = a.FIRMWARE
			and c.SAMPLE = a.SAMPLE
			and c.CATEGORY = a.CATEGORY
			and c.TEST_ITEM = a.TEST_ITEM
		order by b.seq , a.category, a.test_item
		
	</select>
	
	<select id="dashboard.corona.emmc.detail.last" resultType="hashmap">
		Select 
			*		
		From 
		(
			select
				A.*, ROWNUM AS ROW_NUM
			from 
			(
					
				select
					d.YYYYMM,
					d.TEST_BOARD,
					m.SAMPLE,
					m.FIRMWARE,
					d.SCRIPT_NAME,
					d.SAMPLE_NUMBER,
					d.SCRIPT,		
					
					d.SEQ,
					d.TEST_TIME,
					nvl(m.STATUS,'Not Yet') as STATUS,
					d.STATUS_DETAIL,
					d.DURATION,	
					
					m.SCRIPT_NAME as SCRIPT_NAME_META,
					sm.CONVERT_SCRIPT,	
					m.CATEGORY, 
					m.TEST_ITEM, 
					m.TIME TEST_TIME_MASTER, 
					m.CUSTOMER_ITEM, 
					m.NEED_VENDOR_CMD, 
					m.NEED_POWER_CYCLE, 
					m.EMMC_VER, 
					m.TARGET_DEVICE, 
					m.TARGET_PARTITION, 
					m.CATEGORY1, 
					m.CATEGORY2, 
					m.CATEGORY3, 
					m.CATEGORY4, 
					m.CATEGORY5, 
					m.WRITE_MODE, 
					m.READ_MODE, 
					substr(m.DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
					m.DESCRIPTION,
					substr(m.ARGUMENT,1,20) || ' ...'  as  ARGUMENT_SIMPLE, 
					m.ARGUMENT, 
					m.PLATFORM, 
					m.FUNCTION_NAME,
					m.JIRA
					
				from CORONA_EMMC_F_S_MAP m
				left outer join CORONA_EMMC_TEST_DETAIL_LAST d
					on m.firmware = d.firmware
					and m.sample = d.sample
					and m.script_name = d.script
				left outer join CORONA_EMMC_SCRIPT_MASTER sm 
					on sm.script_name = m.script_name
				where 1=1 
				<if test="sample != null and sample != '' " >and m.sample = #{sample}</if>
				<if test="firmware != null and firmware != '' " >and m.FIRMWARE = #{firmware}</if>
				<if test="category != null and category != '' " >and m.CATEGORY = #{category}</if>
				<if test="testItem != null and testItem != '' " > and m.test_item = #{testItem}</if>
				<if test="script_name != null and script_name != '' " > and m.script_name = #{script_name}</if>
				<if test="countGubun != null and countGubun != '' and countGubun == 'pass' " > and m.STATUS = 'PASS'</if>
				<if test="countGubun != null and countGubun != '' and countGubun == 'fail' " > and m.STATUS = 'FAIL'</if>
				<if test="countGubun != null and countGubun != '' and countGubun == 'notyet' " > and m.STATUS is null</if>
				
				order by m.SAMPLE,m.FIRMWARE, m.TEST_ITEM,d.YYYYMM,d.TEST_BOARD, d.SAMPLE, d.FIRMWARE, d.SCRIPT_NAME, d.SAMPLE_NUMBER, d.SCRIPT
			) A
			where 1=1
			<choose>
			<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
				and (
				<if test="filters.rules.size() > 0" >
		       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
		           		<if test="index > 0 "> ${filters.groupOp} </if>  REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
		       		</foreach>	
		       	</if>	
		       	<if test="filters.groups != null and filters.groups.size() > 0">
	       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
		       			<if test="group.rules.size() > 0">
		       			${filters.groupOp}
			           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
				        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
				       	</foreach>
				       	</if>
			       	</foreach>
	       		</if> 
	       		 )
	   		</when>
  			</choose>
		) A
		where
    	<![CDATA[
	    	A.row_num >  to_number(#{rows}) * (to_number(#{page}) -1) 
	    	and A.row_num <= to_number(#{rows}) * to_number(#{page})
    	]]>
	</select>
	<select id="dashboard.corona.emmc.detail.last.page" resultType="hashmap">
		select 
				ceil(count(*)/ #{rows} ) as total,
				#{page} as page ,
				count(*) records 
			from 
			(
				select a.* from (
					select
						d.YYYYMM,
						d.TEST_BOARD,
						d.SAMPLE,
						d.FIRMWARE,
						d.SCRIPT_NAME,
						d.SAMPLE_NUMBER,
						d.SCRIPT,
						d.SEQ,
						d.TEST_TIME,
						nvl(m.STATUS,'Not Yet') as STATUS,
						d.STATUS_DETAIL,
						d.DURATION,	
						
						
						m.SCRIPT_NAME as SCRIPT_NAME_META,
						sm.CONVERT_SCRIPT,
						m.CATEGORY, 
						m.TEST_ITEM, 
						m.TIME TEST_TIME_MASTER, 
						m.CUSTOMER_ITEM, 
						m.NEED_VENDOR_CMD, 
						m.NEED_POWER_CYCLE, 
						m.EMMC_VER, 
						m.TARGET_DEVICE, 
						m.TARGET_PARTITION, 
						m.CATEGORY1, 
						m.CATEGORY2, 
						m.CATEGORY3, 
						m.CATEGORY4, 
						m.CATEGORY5, 
						m.WRITE_MODE, 
						m.READ_MODE, 
						substr(m.DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
						m.DESCRIPTION,
						substr(m.ARGUMENT,1,20) || ' ...'  as  ARGUMENT_SIMPLE, 
						m.ARGUMENT, 
						m.PLATFORM, 
						m.FUNCTION_NAME,
						m.JIRA
						
					from CORONA_EMMC_F_S_MAP m
					left outer join CORONA_EMMC_TEST_DETAIL_LAST d
						on m.firmware = d.firmware
						and m.sample = d.sample
						and m.script_name = d.script
					left outer join CORONA_EMMC_SCRIPT_MASTER sm 
						on sm.script_name = m.script_name
					where 1=1 
					<if test="sample != null and sample != '' " >and m.sample = #{sample}</if>
					<if test="firmware != null and firmware != '' " >and m.FIRMWARE = #{firmware}</if>
					<if test="category != null and category != '' " >and m.CATEGORY = #{category}</if>
					<if test="testItem != null and testItem != '' " > and m.test_item = #{testItem}</if>
					<if test="script_name != null and script_name != '' " > and m.script_name = #{script_name}</if>
					<if test="countGubun != null and countGubun != '' and countGubun == 'pass' " > and m.STATUS = 'PASS'</if>
					<if test="countGubun != null and countGubun != '' and countGubun == 'fail' " > and m.STATUS = 'FAIL'</if>
					<if test="countGubun != null and countGubun != '' and countGubun == 'notyet' " > and m.STATUS is null</if>
					order by m.SAMPLE,m.FIRMWARE, m.TEST_ITEM,d.YYYYMM,d.TEST_BOARD, d.SAMPLE, d.FIRMWARE, d.SCRIPT_NAME, d.SAMPLE_NUMBER, d.SCRIPT
				) A
				where 1=1
				<choose>
				<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
					and (
					<if test="filters.rules.size() > 0" >
			       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
			           		<if test="index > 0 "> ${filters.groupOp} </if>  REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
			       		</foreach>	
			       	</if>	
			       	<if test="filters.groups != null and filters.groups.size() > 0">
		       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
			       			<if test="group.rules.size() > 0">
			       			${filters.groupOp}
				           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
					        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
					       	</foreach>
					       	</if>
				       	</foreach>
		       		</if> 
		       		 )
		   		</when>
	  			</choose>
			)
		
		
		
				
	</select>
	<select id="dashboard.corona.emmc.detail.subDetail" resultType="hashmap">
		select
			nvl(m.STATUS,'Not Yet') as STATUS,
			m.SCRIPT_NAME as SCRIPT_NAME_META,
			m.CATEGORY, 
			m.TEST_ITEM, 
			m.TIME TEST_TIME_MASTER, 
			m.CUSTOMER_ITEM, 
			m.NEED_VENDOR_CMD, 
			m.NEED_POWER_CYCLE, 
			m.EMMC_VER, 
			m.TARGET_DEVICE, 
			m.TARGET_PARTITION, 
			m.CATEGORY1, 
			m.CATEGORY2, 
			m.CATEGORY3, 
			m.CATEGORY4, 
			m.CATEGORY5, 
			m.WRITE_MODE, 
			m.READ_MODE, 
			substr(m.DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
			m.DESCRIPTION,
			substr(m.ARGUMENT,1,20) || ' ...'  as  ARGUMENT_SIMPLE, 
			m.ARGUMENT, 
			m.PLATFORM, 
			m.FUNCTION_NAME,
			m.JIRA
			
		from CORONA_EMMC_F_S_MAP m
		where m.sample = #{sample}
		and m.FIRMWARE = #{firmware}
		and m.SCRIPT_NAME = #{script_name}
	</select>
	<select id="dashboard.corona.emmc.detail" resultType="hashmap">
		select
			d.YYYYMM,
			d.TEST_BOARD,
			d.SAMPLE,
			d.FIRMWARE,
			d.SCRIPT_NAME,
			d.SAMPLE_NUMBER,
			d.SCRIPT,			
			sm.CONVERT_SCRIPT,
			d.SEQ,
			to_char(d.TEST_TIME,'YYYY-MM-DD HH24:MI:SS') as TEST_TIME,
			d.STATUS,
			d.STATUS_DETAIL,
			d.DURATION,
			s.FILE_NAME,
			s.FILA_PATH			
		from CORONA_EMMC_TEST_DETAIL d
		left outer join CORONA_EMMC_TEST_SUMMARY s
			on s.YYYYMM = d.YYYYMM
			and s.TEST_BOARD = d.TEST_BOARD
			and s.SAMPLE = d.SAMPLE
			and s.FIRMWARE = d.FIRMWARE
			and s.SCRIPT_NAME = d.SCRIPT_NAME
			and s.SAMPLE_NUMBER = d.SAMPLE_NUMBER
		left outer join CORONA_EMMC_SCRIPT_MASTER sm
			on sm.script_name = d.script
		where 1=1
		and d.test_board = #{test_board}		
		and d.sample = #{sample}
		and d.FIRMWARE = #{firmware}
		and d.script = #{script}		
		order by d.YYYYMM,d.TEST_BOARD, d.SAMPLE, d.FIRMWARE, d.SCRIPT_NAME, d.SAMPLE_NUMBER, d.SCRIPT
				
	</select>
	<select id="dashboard.corona.emmc.search.firmware" resultType="hashmap">
		select 
			a.SAMPLE,
			a.FIRMWARE,
			a.FIRMWARE || '' 
			--case  
			--	when c.TEST_SET_ID  is not null then 
			--		'( ' || c.TEST_SET_NAME || ' )'
			--	else ''
			-- end 
			as FIRMWARE_NM,
			b.REQUEST_ID,
			(SELECT CASE WHEN CODE_ID = 'SPM_00005011' THEN 'eMMC' ELSE 'SSD' END FROM SOLUTIONPMS.PJT_BASE_INFO@Pms_dsbd_inf WHERE CODE_NAME = 'Application' AND PJT_ID = B.PJT_ID)  as APP_TYPE  ,
			b.RELEASE_STATUS_CD,
			SOLUTIONPMS.FN_CODE_VALUE_ID@Pms_dsbd_inf(b.RELEASE_STATUS_CD) RELEASE_STATUS_NM,
			b.VERIFY_RESULT_CD,
			SOLUTIONPMS.FN_CODE_VALUE_ID@Pms_dsbd_inf(b.VERIFY_RESULT_CD) VERIFY_RESULT_NM,
			c.TEST_SET_ID,
			c.TEST_SET_NAME,
			(
				select 
					to_char(min(nvl(TEST_TIME,ins_dt)),'YYYY-MM-DD')
				from CORONA_EMMC_TEST_DETAIL t
				where a.sample = t.SAMPLE
				and a.firmware = t.FIRMWARE
			) as START_DT
		from CORONA_EMMC_FIRMWARE_MASTER A
		left outer join SOLUTIONPMS.FW_RELEASE@Pms_dsbd_inf b
			on A.firmware = b.fw_version
			and (SELECT CASE WHEN CODE_ID = 'SPM_00005011' THEN 'eMMC' ELSE 'SSD' END FROM SOLUTIONPMS.PJT_BASE_INFO@Pms_dsbd_inf WHERE CODE_NAME = 'Application' AND PJT_ID = B.PJT_ID) != 'SSD'
			and SOLUTIONPMS.FN_CODE_VALUE_ID@Pms_dsbd_inf(b.VERIFY_RESULT_CD) = 'Pass'
			and SOLUTIONPMS.FN_CODE_VALUE_ID@Pms_dsbd_inf(b.RELEASE_STATUS_CD) != 'Cancelled'
			and NVL(b.OVT_YN, 'N') = 'N'
		left outer join SOLUTIONPMS.FW_RELEASE_TEST_SET@Pms_dsbd_inf c
			on b.FVT_TEST_SET_ID = c.TEST_SET_ID
		where 1=1
		<choose>
			<when test="sample != null and sample != '' ">
				and a.sample = #{sample}
			</when>
			<otherwise>
				and 1 = 2
			</otherwise>
		</choose>
		order by START_DT desc
	</select>
	
	<select id="dashboard.corona.emmc.search.sample" resultType="hashmap">
		with tbl_project as (
			select
				distinct a.SAMPLE
			from CORONA_EMMC_FIRMWARE_MASTER a
			where 1=1
			and not exists (
				select * from CORONA_EMMC_PROJECT t
				where t.use_yn = 'N'
				and a.sample = t.project
			)
		)
		
		select 
			a.sample,
			b.use_yn,
			nvl(b.scriptset,'Normal') as default_scriptset
		from tbl_project a
		left outer join CORONA_EMMC_PROJECT b
		on a.sample = b.project
		order by 1
	
	</select>
	<select id="dashboard.corona.emmc.scriptsets.search.by.fimware" resultType="hashmap">
		select
			SCRIPTSET
		from CORONA_EMMC_SCRIPTSET_MAP_F
		where firmware = #{firmware}
		and sample= #{sample}
		
		
	</select>
	<update id="dashboard.corona.emmc.testitem.master.update" parameterType="hashmap">
    	declare
	    	cnt number;
	    begin
	    	
	    		select count(*) into cnt from CORONA_EMMC_TESTITEM_MASTER
	    		where FIRMWARE = #{origindata.FIRMWARE}
                and  SAMPLE = #{origindata.SAMPLE}
                and  CATEGORY = #{origindata.CATEGORY} 
                and  TEST_ITEM = #{origindata.TEST_ITEM};
	    		
	    		if cnt = 1 then
	                update CORONA_EMMC_TESTITEM_MASTER set
	                	WEIGHT = #{WEIGHT}, 
	                	COMPUTE_CRETERIA = #{COMPUTE_CRETERIA}, 
	                	COMPUTE_VALUE = #{COMPUTE_VALUE}, 
	  					TEST_STATE = #{testState},
	                	MOD_DT = sysdate
	                where FIRMWARE = #{origindata.FIRMWARE}
	                and  SAMPLE = #{origindata.SAMPLE}
	                and  CATEGORY = #{origindata.CATEGORY} 
	                and  TEST_ITEM = #{origindata.TEST_ITEM};
	          	else
	          		insert into CORONA_EMMC_TESTITEM_MASTER(FIRMWARE, SAMPLE, CATEGORY, TEST_ITEM, WEIGHT, COMPUTE_CRETERIA, COMPUTE_VALUE, TEST_STATE, INS_DT)
	          		values (#{origindata.FIRMWARE}, #{origindata.SAMPLE}, #{origindata.CATEGORY}, #{origindata.TEST_ITEM}, #{WEIGHT}, #{COMPUTE_CRETERIA}, #{COMPUTE_VALUE}, #{testState},sysdate);
	          	
	          	end if;
                
       	 
	    end;
    
    </update>
	
	<select id="dashboard.corona.emmc.script.category.distinct" resultType="hashmap">
		select
			distinct category , 'SELECTED' selected
		from CORONA_EMMC_SCRIPT_MASTER
		order by 1
	
	</select>
	
	<select id="dashboard.corona.emmc.script.test_item.distinct" resultType="hashmap">
		select
			distinct category, test_item , 'SELECTED' selected
		from CORONA_EMMC_SCRIPT_MASTER
		order by 1
	
	</select>
	
	<select id="dashboard.corona.emmc.manage.script.search" resultType="hashmap">
			with tbl_a as (	
				SELECT
						CATEGORY, 
						SCRIPT_NAME, 	
						CONVERT_SCRIPT,
						row_number() over (partition by category order by CATEGORY,SCRIPT_NAME) row_num,
						TEST_ITEM, 
						TIME, 
						CUSTOMER_ITEM, 
						NEED_VENDOR_CMD, 
						NEED_POWER_CYCLE, 
						EMMC_VER, 
						TARGET_DEVICE, 
						TARGET_PARTITION, 
						CATEGORY1, 
						CATEGORY2, 
						CATEGORY3, 
						CATEGORY4, 
						CATEGORY5, 
						WRITE_MODE, 
						READ_MODE, 
						substr(DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
						DESCRIPTION,
						substr(ARGUMENT,1,20) || ' ...'  as  ARGUMENT_SIMPLE, 
						ARGUMENT, 
						PLATFORM, 
						FUNCTION_NAME,
						INS_DT, 
						MOD_DT				
					from CORONA_EMMC_SCRIPT_MASTER a
					where 1=1
					<if test="categoryArr  != null and categoryArr != '' ">
						and a.category in 
						<foreach collection="categoryArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="testItemArr  != null and testItemArr != '' ">
						and a.test_item in 
						<foreach collection="testItemArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					--order by category,test_item, script_name
					order by category ,script_name
				)
				
				select 
					case 
						when a.row_num > 0 and a.row_num <![CDATA[ <= ]]>  500 then '01. ~500'
						when a.row_num >500 and a.row_num <![CDATA[ <=  ]]> 1000 then '02. 500~1000'
						when a.row_num > 1000 and a.row_num <![CDATA[ <=  ]]> 1500 then '03. 1000~1500'
						when a.row_num > 1500 and a.row_num <![CDATA[ <=  ]]> 2000 then '04. 1500~2000'
						when a.row_num > 2000 then '05. 2000~'				
					end as rownum_grp
					,a.*
				from tbl_a a
				
	
	</select>
	<select id="dashboard.corona.emmc.manage.script.search.paging" resultType="hashmap">
		Select 
			*		
		From 
		(
			select
				A.*, ROWNUM AS ROW_NUM
			from 
			(		
				SELECT
						CATEGORY, 
						SCRIPT_NAME, 	
						CONVERT_SCRIPT,
						TEST_ITEM, 
						TIME, 
						CUSTOMER_ITEM, 
						NEED_VENDOR_CMD, 
						NEED_POWER_CYCLE, 
						EMMC_VER, 
						TARGET_DEVICE, 
						TARGET_PARTITION, 
						CATEGORY1, 
						CATEGORY2, 
						CATEGORY3, 
						CATEGORY4, 
						CATEGORY5, 
						WRITE_MODE, 
						READ_MODE, 
						substr(DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
						DESCRIPTION,
						substr(ARGUMENT,1,20) || ' ...'  as  ARGUMENT_SIMPLE, 
						ARGUMENT, 
						PLATFORM, 
						FUNCTION_NAME,
						INS_DT, 
						MOD_DT				
					from CORONA_EMMC_SCRIPT_MASTER a
					where 1=1
					<if test="categoryArr  != null and categoryArr != '' ">
						and a.category in 
						<foreach collection="categoryArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="testItemArr  != null and testItemArr != '' ">
						and a.test_item in 
						<foreach collection="testItemArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					--order by category,test_item, script_name
					order by category ,script_name
				) A
			where 1=1 			
			<choose>
				<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
					and (
					<if test="filters.rules.size() > 0" >
			       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
			           		<if test="index > 0 "> ${filters.groupOp} </if>   REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
			       		</foreach>	
			       	</if>	
			       	<if test="filters.groups != null and filters.groups.size() > 0">
		       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
			       			<if test="group.rules.size() > 0">
			       			${filters.groupOp}
				           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
					        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
					       	</foreach>
					       	</if>
				       	</foreach>
		       		</if> 
		       		 )
		   		</when>
	   		</choose>
	   		   
	   		
		) A
		where
    	<![CDATA[
	    	A.row_num >  to_number(#{rows}) * (to_number(#{page}) -1) 
	    	and A.row_num <= to_number(#{rows}) * to_number(#{page})
    	]]>
				
				
			
	
	</select>
	<select id="dashboard.corona.emmc.manage.script.search.paging.page" resultType="hashmap">
		select 
			ceil(count(*)/ #{rows} ) as total,
			#{page} as page ,
			count(*) records 
		from 
		(
			select a.* from (
				SELECT
						CATEGORY, 
						SCRIPT_NAME, 	
						CONVERT_SCRIPT,
						TEST_ITEM, 
						TIME, 
						CUSTOMER_ITEM, 
						NEED_VENDOR_CMD, 
						NEED_POWER_CYCLE, 
						EMMC_VER, 
						TARGET_DEVICE, 
						TARGET_PARTITION, 
						CATEGORY1, 
						CATEGORY2, 
						CATEGORY3, 
						CATEGORY4, 
						CATEGORY5, 
						WRITE_MODE, 
						READ_MODE, 
						substr(DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
						DESCRIPTION,
						substr(ARGUMENT,1,20) || ' ...'  as  ARGUMENT_SIMPLE, 
						ARGUMENT, 
						PLATFORM, 
						FUNCTION_NAME,
						INS_DT, 
						MOD_DT				
					from CORONA_EMMC_SCRIPT_MASTER a
					where 1=1
					<if test="categoryArr  != null and categoryArr != '' ">
						and a.category in 
						<foreach collection="categoryArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="testItemArr  != null and testItemArr != '' ">
						and a.test_item in 
						<foreach collection="testItemArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					--order by category,test_item, script_name
					order by category ,script_name
				) A
				where 1=1
				<choose>
					<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
						and (
						<if test="filters.rules.size() > 0" >
				       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
				           		<if test="index > 0 "> ${filters.groupOp} </if>   REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
				       		</foreach>	
				       	</if>	
				       	<if test="filters.groups != null and filters.groups.size() > 0">
			       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
				       			<if test="group.rules.size() > 0">
				       			${filters.groupOp}
					           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
						        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
						       	</foreach>
						       	</if>
					       	</foreach>
			       		</if> 
			       		 )
			   		</when>
	   			</choose>
			)
				
				
			
	
	</select>
	
	<select id="dashboard.corona.emmc.manage.script.search.one" resultType="hashmap">
			SELECT
				SCRIPT_NAME, 
				CONVERT_SCRIPT,
				CATEGORY, 
				TEST_ITEM, 
				TIME, 
				CUSTOMER_ITEM, 
				NEED_VENDOR_CMD, 
				NEED_POWER_CYCLE, 
				EMMC_VER, 
				TARGET_DEVICE, 
				TARGET_PARTITION, 
				CATEGORY1, 
				CATEGORY2, 
				CATEGORY3, 
				CATEGORY4, 
				CATEGORY5, 
				WRITE_MODE, 
				READ_MODE, 
				substr(DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
				DESCRIPTION,
				substr(ARGUMENT,1,20) || ' ...'  as  ARGUMENT_SIMPLE, 
				ARGUMENT, 
				PLATFORM, 
				FUNCTION_NAME,
				INS_DT, 
				MOD_DT
			from CORONA_EMMC_SCRIPT_MASTER a
			where script_name = #{script_name}
			order by category,test_item, script_name
	
	</select>
	
	<select id="dashboard.corona.emmc.manage.script.firmware.mapping" resultType="hashmap">
		with tbl_a as (	
			SELECT
				m.SAMPLE,
				m.FIRMWARE,
				m.SCRIPT_NAME, 
				sm.CONVERT_SCRIPT,
				row_number() over (partition by m.category order by m.CATEGORY,m.SCRIPT_NAME) row_num,
				m.CATEGORY, 
				m.TEST_ITEM, 
				m.TIME, 
				m.CUSTOMER_ITEM, 
				m.NEED_VENDOR_CMD, 
				m.NEED_POWER_CYCLE, 
				m.EMMC_VER, 
				m.TARGET_DEVICE, 
				m.TARGET_PARTITION, 
				m.CATEGORY1, 
				m.CATEGORY2, 
				m.CATEGORY3, 
				m.CATEGORY4, 
				m.CATEGORY5, 
				m.WRITE_MODE, 
				m.READ_MODE, 
				substr(m.DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
				m.DESCRIPTION,
				substr(m.ARGUMENT,1,20) || ' ...'  as  ARGUMENT_SIMPLE, 
				m.ARGUMENT, 
				m.PLATFORM, 
				m.FUNCTION_NAME,
				m.INS_DT, 
				m.MOD_DT
			from CORONA_EMMC_F_S_MAP m
			left outer join CORONA_EMMC_SCRIPT_MASTER sm
				on sm.script_name = m.script_name
			where m.sample = #{sample}
			and m.FIRMWARE = #{firmware}
			order by m.category, m.test_item, m.script_name
		)
		select 
			case 
				when a.row_num > 0 and a.row_num <![CDATA[ <= ]]>  500 then '01. ~500'
				when a.row_num >500 and a.row_num <![CDATA[ <=  ]]> 1000 then '02. 500~1000'
				when a.row_num > 1000 and a.row_num <![CDATA[ <=  ]]> 1500 then '03. 1000~1500'
				when a.row_num > 1500 and a.row_num <![CDATA[ <=  ]]> 2000 then '04. 1500~2000'
				when a.row_num > 2000 then '05. 2000~'				
			end as rownum_grp
			,a.*
		from tbl_a a
		
	</select>
	<select id="dashboard.corona.emmc.manage.script.firmware.mapping.paging" resultType="hashmap">
		Select 
			*		
		From 
		(
			select
				A.*, ROWNUM AS ROW_NUM
			from 
			(
				SELECT
					m.SAMPLE,
					m.FIRMWARE,
					m.SCRIPT_NAME, 
					sm.CONVERT_SCRIPT,
					m.CATEGORY, 
					m.TEST_ITEM, 
					m.TIME, 
					m.CUSTOMER_ITEM, 
					m.NEED_VENDOR_CMD, 
					m.NEED_POWER_CYCLE, 
					m.EMMC_VER, 
					m.TARGET_DEVICE, 
					m.TARGET_PARTITION, 
					m.CATEGORY1, 
					m.CATEGORY2, 
					m.CATEGORY3, 
					m.CATEGORY4, 
					m.CATEGORY5, 
					m.WRITE_MODE, 
					m.READ_MODE, 
					substr(m.DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
					m.DESCRIPTION,
					substr(m.ARGUMENT,1,20) || ' ...'  as  ARGUMENT_SIMPLE, 
					m.ARGUMENT, 
					m.PLATFORM, 
					m.FUNCTION_NAME,
					m.INS_DT, 
					m.MOD_DT
				from CORONA_EMMC_F_S_MAP m
				left outer join CORONA_EMMC_SCRIPT_MASTER sm
					on sm.script_name = m.script_name
				where m.sample = #{sample}
				and m.FIRMWARE = #{firmware}
				order by m.category, m.test_item, m.script_name
			)  A
			where 1=1 			
			<choose>
				<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
					and (
					<if test="filters.rules.size() > 0" >
			       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
			           		<if test="index > 0 "> ${filters.groupOp} </if>   REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
			       		</foreach>	
			       	</if>	
			       	<if test="filters.groups != null and filters.groups.size() > 0">
		       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
			       			<if test="group.rules.size() > 0">
			       			${filters.groupOp}
				           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
					        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
					       	</foreach>
					       	</if>
				       	</foreach>
		       		</if> 
		       		 )
		   		</when>
	   		</choose>
	   		   
	   		
		) A
		where
    	<![CDATA[
	    	A.row_num >  to_number(#{rows}) * (to_number(#{page}) -1) 
	    	and A.row_num <= to_number(#{rows}) * to_number(#{page})
    	]]>
		
		
	</select>
	<select id="dashboard.corona.emmc.manage.script.firmware.mapping.paging.page" resultType="hashmap">
		select 
			ceil(count(*)/ #{rows} ) as total,
			#{page} as page ,
			count(*) records 
		from 
		(
			select a.* from (
				SELECT
					m.SAMPLE,
					m.FIRMWARE,
					m.SCRIPT_NAME, 
					sm.CONVERT_SCRIPT,
					m.CATEGORY, 
					m.TEST_ITEM, 
					m.TIME, 
					m.CUSTOMER_ITEM, 
					m.NEED_VENDOR_CMD, 
					m.NEED_POWER_CYCLE, 
					m.EMMC_VER, 
					m.TARGET_DEVICE, 
					m.TARGET_PARTITION, 
					m.CATEGORY1, 
					m.CATEGORY2, 
					m.CATEGORY3, 
					m.CATEGORY4, 
					m.CATEGORY5, 
					m.WRITE_MODE, 
					m.READ_MODE, 
					substr(m.DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
					m.DESCRIPTION,
					substr(m.ARGUMENT,1,20) || ' ...'  as  ARGUMENT_SIMPLE, 
					m.ARGUMENT, 
					m.PLATFORM, 
					m.FUNCTION_NAME,
					m.INS_DT, 
					m.MOD_DT
				from CORONA_EMMC_F_S_MAP m
				left outer join CORONA_EMMC_SCRIPT_MASTER sm
					on sm.script_name = m.script_name
				where m.sample = #{sample}
				and m.FIRMWARE = #{firmware}
				order by m.category, m.test_item, m.script_name
			) A
				where 1=1
				<choose>
					<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
						and (
						<if test="filters.rules.size() > 0" >
				       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
				           		<if test="index > 0 "> ${filters.groupOp} </if>   REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
				       		</foreach>	
				       	</if>	
				       	<if test="filters.groups != null and filters.groups.size() > 0">
			       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
				       			<if test="group.rules.size() > 0">
				       			${filters.groupOp}
					           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
						        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
						       	</foreach>
						       	</if>
					       	</foreach>
			       		</if> 
			       		 )
			   		</when>
	   			</choose>
			)
		
		
	</select>
	<select id="dashboard.corona.emmc.manage.script.firmware.mapping.one" resultType="hashmap">
		
		SELECT
				m.SAMPLE,
				m.FIRMWARE,
				m.SCRIPT_NAME, 		
				sm.CONVERT_SCRIPT,		
				m.CATEGORY, 
				m.TEST_ITEM, 
				m.TIME, 
				m.CUSTOMER_ITEM, 
				m.NEED_VENDOR_CMD, 
				m.NEED_POWER_CYCLE, 
				m.EMMC_VER, 
				m.TARGET_DEVICE, 
				m.TARGET_PARTITION, 
				m.CATEGORY1, 
				m.CATEGORY2, 
				m.CATEGORY3, 
				m.CATEGORY4, 
				m.CATEGORY5, 
				m.WRITE_MODE, 
				m.READ_MODE, 
				substr(m.DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
				m.DESCRIPTION,
				substr(m.ARGUMENT,1,20) || ' ...'  as  ARGUMENT_SIMPLE, 
				m.ARGUMENT, 
				m.PLATFORM, 
				m.FUNCTION_NAME,
				m.INS_DT, 
				m.MOD_DT
			from CORONA_EMMC_F_S_MAP m
			left outer join CORONA_EMMC_SCRIPT_MASTER sm
				on sm.script_name = m.script_name
			where m.sample = #{sample}
			and m.FIRMWARE = #{firmware}
			and m.script_name = #{script_name}
			order by m.category, m.test_item, m.script_name
		
	</select>
	
	<update id="dashboard.corona.emmc.script_master.update" parameterType="hashmap" >
    	declare
	    	cnt number;
	    	v_script_name varchar2(2000);
	    	v_convert_script varchar2(2000);
	    	v_status varchar2(10);
	    begin
	    	
	    		select count(*) into cnt from CORONA_EMMC_SCRIPT_MASTER
	    		where 1=1
	    		<choose>
						<when test="searchJson != null and searchJson != '' and searchJson.origindatas.size() > 0 " >
			       		<foreach collection="searchJson.origindatas" item="item" index="index"  >
			       			and ${item.field} = #{item.value}
			       		</foreach>
			   		</when>
			   		<otherwise>
			   			and 1=2
			   		</otherwise>
		   		</choose>   
	    		;
	    		
	    		if cnt = 1 then
	    			update CORONA_EMMC_SCRIPT_MASTER set
	              	${fieldName} = #{fieldValue},	  
	              	MOD_DT = sysdate
	              	where 1=1
		    		<choose>
						<when test="searchJson != null and searchJson != '' and searchJson.origindatas.size() > 0 " >
				       		<foreach collection="searchJson.origindatas" item="item" index="index"  >
				       			and ${item.field} = #{item.value}
				       		</foreach>
				   		</when>
				   		<otherwise>
				   			and 1=2
				   		</otherwise>
			   		</choose>          	
	          		;
	          		
	          		<if test= "fieldName != 'CONVERT_SCRIPT' ">
		          		update CORONA_EMMC_SCRIPTSET_MAP set
		              	${fieldName} = #{fieldValue},	  
		              	MOD_DT = sysdate
		              	where 1=1
			    		<choose>
								<when test="searchJson != null and searchJson != '' and searchJson.origindatas.size() > 0 " >
					       		<foreach collection="searchJson.origindatas" item="item" index="index"  >
					       			and ${item.field} = #{item.value}
					       		</foreach>
					   		</when>
					   		<otherwise>
					   			and 1=2
					   		</otherwise>
				   		</choose>          	
		          		;
	          		
	          		
		          		update CORONA_EMMC_F_S_MAP set
		              	${fieldName} = #{fieldValue},	  
		              	MOD_DT = sysdate
		              	where 1=1
			    		<choose>
								<when test="searchJson != null and searchJson != '' and searchJson.origindatas.size() > 0 " >
					       		<foreach collection="searchJson.origindatas" item="item" index="index"  >
					       			and ${item.field} = #{item.value}
					       		</foreach>
					   		</when>
					   		<otherwise>
					   			and 1=2
					   		</otherwise>
				   		</choose>          	
		          		;
	          		
		          </if>		
			       <if test= "fieldName == 'CONVERT_SCRIPT' ">
			        	update CORONA_EMMC_TEST_DETAIL set
	          			CONVERT_SCRIPT = #{fieldValue},
	          			MOD_DT = sysdate
	          			where CONVERT_SCRIPT = #{fieldValueOrigin};
			        </if>
	          		
	          		<if test= "fieldName == 'SCRIPT_NAME' ">
	          			v_script_name := #{fieldValue};   
	          			
	          			--// update CORONA_EMMC_SCRIPTSET_MAP
	          			 update CORONA_EMMC_SCRIPTSET_MAP set
	          			 SCRIPT_NAME = #{fieldValue},
	          			 DESCRIPTION = DESCRIPTION || case when DESCRIPTION is not null then  chr(10) end  || to_char(sysdate,'YYYY-MM-DD HH24:MI') || ': ' || #{fieldValueOrigin} || ' ==> ' || #{fieldValue} || ' ( ${userId} )'  ,
	          			 MOD_DT = sysdate
	          			 where SCRIPT_NAME = #{fieldValueOrigin};
	          		
	          			--// update_firmware_table	          			
	          			update CORONA_EMMC_F_S_MAP set
	          			SCRIPT_NAME = #{fieldValue},
	          			DESCRIPTION = DESCRIPTION || case when DESCRIPTION is not null then  chr(10) end  || to_char(sysdate,'YYYY-MM-DD HH24:MI') || ': ' || #{fieldValueOrigin} || ' ==> ' || #{fieldValue} || ' ( ${userId} )'  ,
	          			MOD_DT = sysdate
	          			where SCRIPT_NAME = #{fieldValueOrigin};
	          			
				   		
				   		--// update_log_table
	          			update CORONA_EMMC_TEST_DETAIL set
	          			SCRIPT = #{fieldValue},
	          			MOD_DT = sysdate
	          			where Script = #{fieldValueOrigin};
	          			
	          			--// update_log_table
	          			update CORONA_EMMC_TEST_DETAIL_LAST set
	          			SCRIPT = #{fieldValue},
	          			MOD_DT = sysdate
	          			where Script = #{fieldValueOrigin};
	          			
	          			--// update_comment
	          			update CORONA_EMMC_SCRIPT_MASTER set
	          			DESCRIPTION = DESCRIPTION || case when DESCRIPTION is not null then  chr(10) end  || to_char(sysdate,'YYYY-MM-DD HH24:MI') || ': ' || #{fieldValueOrigin} || ' ==> ' || #{fieldValue} || ' ( ${userId} )'  ,
	          			MOD_DT = sysdate
	          			where SCRIPT_NAME = #{fieldValue};
	          			
	          			
	          			--//  Status
		          		for rec_scriptset in (
		          			select SCRIPTSET from CORONA_EMMC_SCRIPT_SETS
		          		) loop 
		          			for rec_firmwares in (
		          				select  FIRMWARE, SAMPLE, SCRIPTSET  from CORONA_EMMC_SCRIPTSET_MAP_F
		          				where SCRIPTSET = rec_scriptset.SCRIPTSET
		          			) loop
		          				--//Start. status update
								v_status := null;
								for rec_detail in (
									select
										STATUS
									from CORONA_EMMC_TEST_DETAIL a
									where a.sample= rec_firmwares.sample
									and a.firmware = rec_firmwares.firmware
									and a.script = v_script_name
									order by YYYYMM
								) loop
									v_status := rec_detail.STATUS;
									if rec_detail.STATUS = 'FAIL' then 
										exit;
									end if;
								end loop;
								
								UPDATE CORONA_EMMC_F_S_MAP SET						
									status = v_status
									,DESCRIPTION = DESCRIPTION || chr(10) || to_char(sysdate,'YYYY-MM-DD HH24:MI') || ': ' || STATUS || ' ==> ' || v_status || ' (management) '
									,MOD_DT = sysdate
								where firmware = rec_firmwares.firmware
								and sample = rec_firmwares.sample
								and script_name =  v_script_name;
								--// End. status update
								
		          				
		          			
		          			end loop;
		          			--// end rec_firmwares
		          			
		          		end loop;
		          		--// end rec_scriptset
		          		--// End Status  		
		          		
	          		</if>
	          		
	          		
	          		
			         
	        	end if;
                
       	 
	    end;
    
    </update>
    <update id="dashboard.corona.emmc.script_master.insert" parameterType="hashmap" >
    	declare
	    	cnt number;
	    	v_status varchar2(100);
	    begin
	    	
    		insert into CORONA_EMMC_SCRIPT_MASTER (SCRIPT_NAME, CONVERT_SCRIPT,  CATEGORY, TEST_ITEM,INS_DT)
            values (#{SCRIPT_NAME}, #{CONVERT_SCRIPT} ,#{CATEGORY},#{TEST_ITEM}, sysdate) ;
                
            select count(*) into cnt from CORONA_EMMC_SCRIPTSET_MAP
            where SCRIPTSET = 'Normal'
            and SCRIPT_NAME = #{SCRIPT_NAME};
            
            if cnt = 0 then
            	insert into CORONA_EMMC_SCRIPTSET_MAP (SCRIPTSET, SCRIPT_NAME, CATEGORY, TEST_ITEM,INS_DT)
            	values ('Normal', #{SCRIPT_NAME},#{CATEGORY},#{TEST_ITEM}, sysdate);
            end if;
	              
	        For rec_firmware in (
				select FIRMWARE, SAMPLE,SCRIPTSET from CORONA_EMMC_SCRIPTSET_MAP_F
				where 1=1
				and SCRIPTSET = 'Normal'
			)
			Loop
				-- DELETE	
				delete from CORONA_EMMC_F_S_MAP 
				where FIRMWARE = rec_firmware.firmware
				and SAMPLE = rec_firmware.sample
				and SCRIPT_NAME = #{SCRIPT_NAME};
				-- INSERT
				insert into CORONA_EMMC_F_S_MAP (FIRMWARE, SAMPLE, SCRIPT_NAME, CATEGORY, TEST_ITEM,INS_DT)
				select
					rec_firmware.firmware,
					rec_firmware.sample,
					SCRIPT_NAME, 
					CATEGORY,
					TEST_ITEM,
					sysdate
				from CORONA_EMMC_SCRIPTSET_MAP
				where SCRIPTSET = 'Normal'
				and script_name = #{SCRIPT_NAME};
					
					
				--// 04 STATUS UPDATE
				for rec_script in (
					select * from CORONA_EMMC_F_S_MAP 
					where firmware = rec_firmware.firmware and sample = rec_firmware.sample
					and script_name = #{SCRIPT_NAME}
				) loop 
					v_status := null;
					for rec_detail in (
						select
							STATUS
						from CORONA_EMMC_TEST_DETAIL a
						where a.sample= rec_script.sample
						and a.firmware = rec_script.firmware
						and a.script = rec_script.script_name
						order by YYYYMM
					) loop
						v_status := rec_detail.STATUS;
						if rec_detail.STATUS = 'FAIL' then 
							exit;
						end if;
					end loop;
					
					UPDATE CORONA_EMMC_F_S_MAP SET						
						status = v_status,
						DESCRIPTION = DESCRIPTION || chr(10) || to_char(sysdate,'YYYY-MM-DD HH24:MI') || ': ' || STATUS || ' ==> ' || v_status || ' (management) ',
						MOD_DT = sysdate
					where firmware = rec_script.firmware
					and sample = rec_script.sample
					and script_name = rec_script.script_name;
				End Loop;
				--// END 04 STATUS UPDATE	
				
			End Loop;
       	 
	    end;
    
    </update>
    
    
    <update id="dashboard.corona.emmc.script_master.delete" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
	    	
	    		delete from CORONA_EMMC_SCRIPT_MASTER
	    		where 1=1
	    		and SCRIPT_NAME = #{detail.SCRIPT_NAME};
	    		
	    		--// 01. delete script set
	    		delete from CORONA_EMMC_SCRIPTSET_MAP
	    		where 1=1
	    		and SCRIPT_NAME = #{detail.SCRIPT_NAME};
	    		
	    		
	    		--// 02. delete firmware
	    		delete from CORONA_EMMC_F_S_MAP
	    		where 1=1
	    		and SCRIPT_NAME = #{detail.SCRIPT_NAME};
	    end;
    
    </update>
    
    
    <update id="dashboard.corona.emmc.firmware_script_map.update" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
	    	
	    		select count(*) into cnt from CORONA_EMMC_F_S_MAP
	    		where 1=1
	    		<choose>
						<when test="searchJson != null and searchJson != '' and searchJson.origindatas.size() > 0 " >
			       		<foreach collection="searchJson.origindatas" item="item" index="index"  >
			       			and ${item.field} = #{item.value}
			       		</foreach>
			   		</when>
			   		<otherwise>
			   			and 1=2
			   		</otherwise>
		   		</choose>   
	    		;
	    		
	    		if cnt = 1 then
	              	update CORONA_EMMC_F_S_MAP set
	              	${fieldName} = #{fieldValue},	  
	              	MOD_DT = sysdate
	              	where 1=1
		    		<choose>
							<when test="searchJson != null and searchJson != '' and searchJson.origindatas.size() > 0 " >
				       		<foreach collection="searchJson.origindatas" item="item" index="index"  >
				       			and ${item.field} = #{item.value}
				       		</foreach>
				   		</when>
				   		<otherwise>
				   			and 1=2
				   		</otherwise>
			   		</choose>          	
	          		;
	        end if;
                
       	 
	    end;
    
    </update>
    <update id="dashboard.corona.emmc.firmware_script_map.insert" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
	    	
	    		insert into CORONA_EMMC_F_S_MAP (FIRMWARE, SAMPLE, SCRIPT_NAME, CATEGORY, TEST_ITEM,INS_DT)
                values (#{FIRMWARE},#{SAMPLE},#{SCRIPT_NAME},#{CATEGORY},#{TEST_ITEM}, sysdate) ;
       	 
	    end;
    
    </update>
    <update id="dashboard.corona.emmc.firmware_script_map.delete.back" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
	    		for rec in (
	    			with tbl_list as (
	    				select 'xxx' as firmware , 'xxx' as sample , 'xxx' as script_name  from dual
	    				<choose>
						<when test="searchJson != null and searchJson != '' and searchJson.delRows.size() > 0 " >
	    				<foreach collection="searchJson.delRows" item="item" index="index"  open=" union all  " separator=" union all " close=" ">
			       			select #{item.FIRMWARE} as firmware , #{item.SAMPLE} as sample , #{item.SCRIPT_NAME} as script_name  from dual
			       		</foreach>
			       		</when>
			       		</choose>
	    			)
	    			
	    			select * from tbl_list
	    			
	    		) loop 
	    			delete from CORONA_EMMC_F_S_MAP 
	    			where firmware = rec.firmware
	    			and sample = rec.sample
	    			and script_name = rec.script_name;
	    		
	    		end loop;
	    end;
    
    </update>
    <update id="dashboard.corona.emmc.firmware_script_map.delete" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
	    		for rec in (
	    			with tbl_list as (
	    				select 'xxx' as firmware , 'xxx' as sample , 'xxx' as script_name  from dual
	    				union all
			       		select #{detail.FIRMWARE} as firmware , #{detail.SAMPLE} as sample , #{detail.SCRIPT_NAME} as script_name  from dual
	    			)
	    			
	    			select * from tbl_list
	    			
	    		) loop 
	    			delete from CORONA_EMMC_F_S_MAP 
	    			where firmware = rec.firmware
	    			and sample = rec.sample
	    			and script_name = rec.script_name;
	    		
	    		end loop;
	    end;
    
    </update>
    
    <select id="dashboard.corona.emmc.historyno" resultType="hashmap">
		SELECT LPAD(TO_NUMBER(nvl(max(HISTORY_NO),'0'))+1, 10,'0') HISTORY_NO from  CORONA_EMMC_HISTORY_NO
    </select>
    <update id="dashboard.corona.emmc.manage.insert.historyno.copy_template_project" parameterType="hashmap" >
    	DECLARE
	    	cnt number;
	    	v_history_no varchar2(100) := #{history_no};
	    BEGIN
	    	INSERT INTO CORONA_EMMC_HISTORY_NO (HISTORY_NO, INS_DT) VALUES (v_history_no , sysdate );
	    	insert into CORONA_EMMC_MAP_HISTORY (HISTORY_NO, FIRMWARE, SAMPLE, SCRIPT_NAME, CATEGORY, TEST_ITEM, TIME, CUSTOMER_ITEM, NEED_VENDOR_CMD, NEED_POWER_CYCLE, EMMC_VER, TARGET_DEVICE, TARGET_PARTITION, CATEGORY1, CATEGORY2, CATEGORY3, CATEGORY4, CATEGORY5, WRITE_MODE, READ_MODE, DESCRIPTION, ARGUMENT, PLATFORM, FUNCTION_NAME, INS_DT, MOD_DT)
	    		select 
	    			v_history_no,
	    			FIRMWARE, SAMPLE, SCRIPT_NAME, CATEGORY, TEST_ITEM, TIME, CUSTOMER_ITEM, NEED_VENDOR_CMD, NEED_POWER_CYCLE, EMMC_VER, TARGET_DEVICE, TARGET_PARTITION, CATEGORY1, CATEGORY2, CATEGORY3, CATEGORY4, CATEGORY5, WRITE_MODE, READ_MODE, DESCRIPTION, ARGUMENT, PLATFORM, FUNCTION_NAME, INS_DT, MOD_DT
	    		from CORONA_EMMC_F_S_MAP
	    		where 1=1
	    		and sample = #{searchJson.target.sample} ;
	    End;
    </update>
    <update id="dashboard.corona.emmc.manage.insert.historyno.copy_template_firmware" parameterType="hashmap" >
    	DECLARE
	    	cnt number;
	    	v_history_no varchar2(100) := #{history_no};
	    BEGIN
	    	INSERT INTO CORONA_EMMC_HISTORY_NO (HISTORY_NO, INS_DT) VALUES (v_history_no , sysdate );
	    	insert into CORONA_EMMC_MAP_HISTORY (HISTORY_NO, FIRMWARE, SAMPLE, SCRIPT_NAME, CATEGORY, TEST_ITEM, TIME, CUSTOMER_ITEM, NEED_VENDOR_CMD, NEED_POWER_CYCLE, EMMC_VER, TARGET_DEVICE, TARGET_PARTITION, CATEGORY1, CATEGORY2, CATEGORY3, CATEGORY4, CATEGORY5, WRITE_MODE, READ_MODE, DESCRIPTION, ARGUMENT, PLATFORM, FUNCTION_NAME, INS_DT, MOD_DT)
	    		select 
	    			v_history_no,
	    			FIRMWARE, SAMPLE, SCRIPT_NAME, CATEGORY, TEST_ITEM, TIME, CUSTOMER_ITEM, NEED_VENDOR_CMD, NEED_POWER_CYCLE, EMMC_VER, TARGET_DEVICE, TARGET_PARTITION, CATEGORY1, CATEGORY2, CATEGORY3, CATEGORY4, CATEGORY5, WRITE_MODE, READ_MODE, DESCRIPTION, ARGUMENT, PLATFORM, FUNCTION_NAME, INS_DT, MOD_DT
	    		from CORONA_EMMC_F_S_MAP
	    		where 1=1
	    		and sample = #{searchJson.target.sample}
	    		and firmware = #{searchJson.target.firmware}
	    		 ;
	    End;
    </update>
    <update id="dashboard.corona.emmc.manage.insert.historyno.copy_firmware_firmware" parameterType="hashmap" >
    	DECLARE
	    	cnt number;
	    	v_history_no varchar2(100) := #{history_no};
	    BEGIN
	    	INSERT INTO CORONA_EMMC_HISTORY_NO (HISTORY_NO, INS_DT) VALUES (v_history_no , sysdate );
	    	insert into CORONA_EMMC_MAP_HISTORY (HISTORY_NO, FIRMWARE, SAMPLE, SCRIPT_NAME, CATEGORY, TEST_ITEM, TIME, CUSTOMER_ITEM, NEED_VENDOR_CMD, NEED_POWER_CYCLE, EMMC_VER, TARGET_DEVICE, TARGET_PARTITION, CATEGORY1, CATEGORY2, CATEGORY3, CATEGORY4, CATEGORY5, WRITE_MODE, READ_MODE, DESCRIPTION, ARGUMENT, PLATFORM, FUNCTION_NAME, INS_DT, MOD_DT)
	    		select 
	    			v_history_no,
	    			FIRMWARE, SAMPLE, SCRIPT_NAME, CATEGORY, TEST_ITEM, TIME, CUSTOMER_ITEM, NEED_VENDOR_CMD, NEED_POWER_CYCLE, EMMC_VER, TARGET_DEVICE, TARGET_PARTITION, CATEGORY1, CATEGORY2, CATEGORY3, CATEGORY4, CATEGORY5, WRITE_MODE, READ_MODE, DESCRIPTION, ARGUMENT, PLATFORM, FUNCTION_NAME, INS_DT, MOD_DT
	    		from CORONA_EMMC_F_S_MAP
	    		where 1=1
	    		and sample = #{searchJson.target.sample}
	    		and firmware = #{searchJson.target.firmware}
	    		 ;
	    End;
    </update>
    
    <update id="dashboard.corona.emmc.manage.script_copy_project.update" parameterType="hashmap" >
    	DECLARE
	    	cnt number;
	    	v_history_no varchar2(100) := #{history_no};
	    BEGIN
	    		
	    	--// Revision Start	    		
	    	For rec_firmware in (
	    		select distinct firmware from CORONA_EMMC_FIRMWARE_MASTER where sample = #{searchJson.target.sample}
	    	) Loop
	    		
	    		--// second Loop
	    		FOR rec in (
	    			select * from CORONA_EMMC_SCRIPT_MASTER
					where 1=1
					and script_name = #{detail.SCRIPT_NAME}    			
	    		) LOOP 
		    		
			    			
					select count(*) into cnt from CORONA_EMMC_F_S_MAP
					where firmware = rec_firmware.firmware
					and sample = #{searchJson.target.sample}
					and script_name = rec.SCRIPT_NAME;
					
					IF cnt = 0 THEN
						insert into CORONA_EMMC_F_S_MAP (FIRMWARE, SAMPLE, SCRIPT_NAME, CATEGORY, TEST_ITEM, TIME, CUSTOMER_ITEM, NEED_VENDOR_CMD, NEED_POWER_CYCLE, EMMC_VER, TARGET_DEVICE, TARGET_PARTITION, CATEGORY1, CATEGORY2, CATEGORY3, CATEGORY4, CATEGORY5, WRITE_MODE, READ_MODE, DESCRIPTION, ARGUMENT,PLATFORM, FUNCTION_NAME, INS_DT)
						values (
							rec_firmware.firmware , #{searchJson.target.sample}
							, rec.SCRIPT_NAME, rec.CATEGORY, rec.TEST_ITEM, rec.TIME, rec.CUSTOMER_ITEM, rec.NEED_VENDOR_CMD, rec.NEED_POWER_CYCLE, rec.EMMC_VER, rec.TARGET_DEVICE, rec.TARGET_PARTITION, rec.CATEGORY1,rec. CATEGORY2, rec.CATEGORY3, rec.CATEGORY4, rec.CATEGORY5, rec.WRITE_MODE, rec.READ_MODE, rec.DESCRIPTION, rec.ARGUMENT, rec.PLATFORM, rec.FUNCTION_NAME
							, sysdate
						);
					ELSE
					
						UPDATE CORONA_EMMC_F_S_MAP SET
							CATEGORY = rec.CATEGORY,
							TEST_ITEM = rec.TEST_ITEM,
							TIME = rec.TIME,
							CUSTOMER_ITEM = rec.CUSTOMER_ITEM,
							NEED_VENDOR_CMD = rec.NEED_VENDOR_CMD,
							NEED_POWER_CYCLE = rec.NEED_POWER_CYCLE,
							EMMC_VER = rec.EMMC_VER,
							TARGET_DEVICE = rec.TARGET_DEVICE,
							TARGET_PARTITION = rec.TARGET_PARTITION,
							CATEGORY1 = rec.CATEGORY1,
							CATEGORY2 = rec.CATEGORY2,
							CATEGORY3 = rec.CATEGORY3,
							CATEGORY4 = rec.CATEGORY4,
							CATEGORY5 = rec.CATEGORY5,
							WRITE_MODE = rec.WRITE_MODE,
							READ_MODE = rec.READ_MODE,
							DESCRIPTION = rec.DESCRIPTION,
							ARGUMENT = rec.ARGUMENT,
							PLATFORM = rec.PLATFORM,
							FUNCTION_NAME =  rec.FUNCTION_NAME,
							MOD_DT = sysdate
						WHERE firmware = rec_firmware.firmware
						AND sample = #{searchJson.target.sample}
						AND script_name = rec.script_name; 
						
						
					END IF;
					
				End Loop;
	    	
	    	End Loop;
	    	 
	    	
	    		
	    	
	 			
	    END;
    
    </update>
    
    <update id="dashboard.corona.emmc.manage.script_copy_firmware.update" parameterType="hashmap" >
    	DECLARE
	    	cnt number;
	    	v_history_no varchar2(100) := #{history_no};
	    BEGIN
	    		
	    	--// Revision Start	    		
	    	For rec_firmware in (
	    		select distinct firmware from CORONA_EMMC_FIRMWARE_MASTER where sample = #{searchJson.target.sample} and firmware = #{searchJson.target.firmware} 
	    	) Loop
	    		
	    		--// second Loop
	    		FOR rec in (
	    			select * from CORONA_EMMC_SCRIPT_MASTER
					where 1=1
					and script_name = #{detail.SCRIPT_NAME}    			
	    		) LOOP 
		    		
			    			
					select count(*) into cnt from CORONA_EMMC_F_S_MAP
					where firmware = rec_firmware.firmware
					and sample = #{searchJson.target.sample}
					and script_name = rec.SCRIPT_NAME;
					
					IF cnt = 0 THEN
						insert into CORONA_EMMC_F_S_MAP (FIRMWARE, SAMPLE, SCRIPT_NAME, CATEGORY, TEST_ITEM, TIME, CUSTOMER_ITEM, NEED_VENDOR_CMD, NEED_POWER_CYCLE, EMMC_VER, TARGET_DEVICE, TARGET_PARTITION, CATEGORY1, CATEGORY2, CATEGORY3, CATEGORY4, CATEGORY5, WRITE_MODE, READ_MODE, DESCRIPTION, ARGUMENT,PLATFORM, FUNCTION_NAME, INS_DT)
						values (
							rec_firmware.firmware , #{searchJson.target.sample}
							, rec.SCRIPT_NAME, rec.CATEGORY, rec.TEST_ITEM, rec.TIME, rec.CUSTOMER_ITEM, rec.NEED_VENDOR_CMD, rec.NEED_POWER_CYCLE, rec.EMMC_VER, rec.TARGET_DEVICE, rec.TARGET_PARTITION, rec.CATEGORY1,rec. CATEGORY2, rec.CATEGORY3, rec.CATEGORY4, rec.CATEGORY5, rec.WRITE_MODE, rec.READ_MODE, rec.DESCRIPTION, rec.ARGUMENT, rec.PLATFORM, rec.FUNCTION_NAME
							, sysdate
						);
					ELSE
					
						UPDATE CORONA_EMMC_F_S_MAP SET
							CATEGORY = rec.CATEGORY,
							TEST_ITEM = rec.TEST_ITEM,
							TIME = rec.TIME,
							CUSTOMER_ITEM = rec.CUSTOMER_ITEM,
							NEED_VENDOR_CMD = rec.NEED_VENDOR_CMD,
							NEED_POWER_CYCLE = rec.NEED_POWER_CYCLE,
							EMMC_VER = rec.EMMC_VER,
							TARGET_DEVICE = rec.TARGET_DEVICE,
							TARGET_PARTITION = rec.TARGET_PARTITION,
							CATEGORY1 = rec.CATEGORY1,
							CATEGORY2 = rec.CATEGORY2,
							CATEGORY3 = rec.CATEGORY3,
							CATEGORY4 = rec.CATEGORY4,
							CATEGORY5 = rec.CATEGORY5,
							WRITE_MODE = rec.WRITE_MODE,
							READ_MODE = rec.READ_MODE,
							DESCRIPTION = rec.DESCRIPTION,
							ARGUMENT = rec.ARGUMENT,
							PLATFORM = rec.PLATFORM,
							FUNCTION_NAME =  rec.FUNCTION_NAME,
							MOD_DT = sysdate
						WHERE firmware = rec_firmware.firmware
						AND sample = #{searchJson.target.sample}
						AND script_name = rec.script_name; 
						
						
					END IF;
					
				End Loop;
	    	
	    	End Loop;
	    	 
	    	
	    		
	    	
	 			
	    END;
    
    </update>
    <update id="dashboard.corona.emmc.manage.firmware_copy_firmware.update" parameterType="hashmap" >
    	DECLARE
	    	cnt number;
	    	v_history_no varchar2(100) := #{history_no};
	    BEGIN
	    		
	    	--// Revision Start	    		
	    	For rec_firmware in (
	    		select distinct firmware from CORONA_EMMC_FIRMWARE_MASTER where sample = #{searchJson.target.sample} and firmware = #{searchJson.target.firmware} 
	    	) Loop
	    		
	    		--// second Loop
	    		FOR rec in (
	    			select * from CORONA_EMMC_F_S_MAP
					where 1=1
					and firmware = #{detail.FIRMWARE}
					and sample = #{detail.SAMPLE}
					and script_name = #{detail.SCRIPT_NAME}    			
	    		) LOOP 
		    		
			    			
					select count(*) into cnt from CORONA_EMMC_F_S_MAP
					where firmware = rec_firmware.firmware
					and sample = #{searchJson.target.sample}
					and script_name = rec.SCRIPT_NAME;
					
					IF cnt = 0 THEN
						insert into CORONA_EMMC_F_S_MAP (FIRMWARE, SAMPLE, SCRIPT_NAME, CATEGORY, TEST_ITEM, TIME, CUSTOMER_ITEM, NEED_VENDOR_CMD, NEED_POWER_CYCLE, EMMC_VER, TARGET_DEVICE, TARGET_PARTITION, CATEGORY1, CATEGORY2, CATEGORY3, CATEGORY4, CATEGORY5, WRITE_MODE, READ_MODE, DESCRIPTION, ARGUMENT,PLATFORM, FUNCTION_NAME, INS_DT)
						values (
							rec_firmware.firmware , #{searchJson.target.sample}
							, rec.SCRIPT_NAME, rec.CATEGORY, rec.TEST_ITEM, rec.TIME, rec.CUSTOMER_ITEM, rec.NEED_VENDOR_CMD, rec.NEED_POWER_CYCLE, rec.EMMC_VER, rec.TARGET_DEVICE, rec.TARGET_PARTITION, rec.CATEGORY1,rec. CATEGORY2, rec.CATEGORY3, rec.CATEGORY4, rec.CATEGORY5, rec.WRITE_MODE, rec.READ_MODE, rec.DESCRIPTION, rec.ARGUMENT, rec.PLATFORM, rec.FUNCTION_NAME
							, sysdate
						);
					ELSE
					
						UPDATE CORONA_EMMC_F_S_MAP SET						
							CATEGORY = rec.CATEGORY,
							TEST_ITEM = rec.TEST_ITEM,
							TIME = rec.TIME,
							CUSTOMER_ITEM = rec.CUSTOMER_ITEM,
							NEED_VENDOR_CMD = rec.NEED_VENDOR_CMD,
							NEED_POWER_CYCLE = rec.NEED_POWER_CYCLE,
							EMMC_VER = rec.EMMC_VER,
							TARGET_DEVICE = rec.TARGET_DEVICE,
							TARGET_PARTITION = rec.TARGET_PARTITION,
							CATEGORY1 = rec.CATEGORY1,
							CATEGORY2 = rec.CATEGORY2,
							CATEGORY3 = rec.CATEGORY3,
							CATEGORY4 = rec.CATEGORY4,
							CATEGORY5 = rec.CATEGORY5,
							WRITE_MODE = rec.WRITE_MODE,
							READ_MODE = rec.READ_MODE,
							DESCRIPTION = rec.DESCRIPTION,
							ARGUMENT = rec.ARGUMENT,
							PLATFORM = rec.PLATFORM,
							FUNCTION_NAME =  rec.FUNCTION_NAME,
							MOD_DT = sysdate
				
						WHERE firmware = rec_firmware.firmware
						AND sample = #{searchJson.target.sample}
						AND script_name = rec.script_name; 
						
						
					END IF;
					
				End Loop;
	    	
	    	End Loop;
	    	 
	    	
	    		
	    	
	 			
	    END;
    
    </update>
    <update id="dashbaord.corona.emmc.firmware.status.edit" parameterType="hashmap">
    	declare
	    	cnt number;
	    	vStatus varchar2(10) := #{STATUS};
	    	vStatus1 varchar2(10) ;
	    begin
	    		
	    		select count(*) into cnt from CORONA_EMMC_F_S_MAP
	    		where FIRMWARE = #{origindata.FIRMWARE}
                and  SAMPLE = #{origindata.SAMPLE}
                and  SCRIPT_NAME = #{origindata.SCRIPT_NAME_META} ;
	    		
	    		if cnt = 1 then
	    			if vStatus = 'Not Yet' then 
	    				vStatus1 := '';
	    			else
	    				vStatus1 := vStatus;
	    			end if;
	    		
	                update CORONA_EMMC_F_S_MAP set
	                	STATUS = vStatus1, 
	                	STATUS_CUSTOM = 'Y', 
	                	JIRA = #{JIRA},
	                	DESCRIPTION = DESCRIPTION || chr(10) || to_char(sysdate,'YYYY-MM-DD HH24:MI') || ': ' || STATUS || ' ==> ' || #{STATUS} || ' ( ${userId} )'  ,
	  
	                	MOD_DT = sysdate
	                where FIRMWARE = #{origindata.FIRMWARE}
	                and  SAMPLE = #{origindata.SAMPLE}
	                and  SCRIPT_NAME = #{origindata.SCRIPT_NAME_META} ;
	                
	          	end if;
                
       	 
	    end;
    
    </update>
    <update id="dashbaord.corona.emmc.firmware.log.status.edit" parameterType="hashmap">
    	declare
	    	cnt number;
	    	vStatus varchar2(10) := #{STATUS};
	    	vStatus1 varchar2(10) ;
	    begin
	    		
	    		select count(*) into cnt from CORONA_EMMC_TEST_DETAIL
	    		where 1=1
                and  SAMPLE = #{origindata.SAMPLE}
                and FIRMWARE = #{origindata.FIRMWARE}
                and SCRIPT = #{origindata.SCRIPT}
                and YYYYMM = #{origindata.YYYYMM}
                and TEST_BOARD = #{origindata.TEST_BOARD}
                and  SCRIPT_NAME = #{origindata.SCRIPT_NAME}
                and  SAMPLE_NUMBER = #{origindata.SAMPLE_NUMBER};                
	    		
	    		if cnt = 1 then
	    			if vStatus = 'Not Yet' then 
	    				vStatus1 := '';
	    			else
	    				vStatus1 := vStatus;
	    			end if;
	    		
	                update CORONA_EMMC_TEST_DETAIL set
	                	STATUS = vStatus1, 
	                	MOD_DT = sysdate
	                where  SAMPLE = #{origindata.SAMPLE}
	                and FIRMWARE = #{origindata.FIRMWARE}
	                and SCRIPT = #{origindata.SCRIPT}
	                and YYYYMM = #{origindata.YYYYMM}
	                and TEST_BOARD = #{origindata.TEST_BOARD}
	                and  SCRIPT_NAME = #{origindata.SCRIPT_NAME}
	                and  SAMPLE_NUMBER = #{origindata.SAMPLE_NUMBER};                
	                
	          	end if;
                
       	 
	    end;
    
    
    </update>
    <update id="dashboard.corona.emmc.manage.firmware.status.update" parameterType="hashmap">
    	declare
			v_status varchar2(10);
		
		begin	
			
			-- start firmware status
			-- 01. firmware script list
			for rec in (
				select
					FIRMWARE,SAMPLE, SCRIPT_NAME
				from CORONA_EMMC_F_S_MAP
				where sample = #{sample}
				and FIRMWARE = #{firmware}	 
				--order by FIRMWARE, SAMPLE, SCRIPT_NAME
			) loop
			-- 02. detail log list , determine status
				v_status := '';
				for rec1 in (
					select
						STATUS
					from CORONA_EMMC_TEST_DETAIL a
					where a.sample= rec.sample
					and a.firmware = rec.firmware
					and a.script = rec.script_name
					order by YYYYMM
				) loop
					v_status := rec1.STATUS;
					if rec1.STATUS = 'FAIL' then 
						exit;
					end if;
				end loop;
				
				update CORONA_EMMC_F_S_MAP set
					status = v_status,
					DESCRIPTION = DESCRIPTION || chr(10) || to_char(sysdate,'YYYY-MM-DD HH24:MI') || ': ' || STATUS || ' ==> ' || v_status || ' (management) ',
					MOD_DT = sysdate
				where firmware = rec.firmware
				and sample= rec.sample
				and script_name = rec.script_name;
				
			end loop;
			
			
		end;
    
    
    </update>
    <select id="dashboard.corona.emmc.autocomplete.script" resultType="hashmap">
		select
			distinct ${field} "id", ${field} "name"
		from CORONA_EMMC_SCRIPT_MASTER
		where REGEXP_LIKE(${field} ,#{term},'i')  
		order by 1
	
	</select>
	
	
	<select id="dashboard.corona.emmc.project.useYn" resultType="hashmap">
		with tbl_project as (
			select distinct sample as project from CORONA_EMMC_FIRMWARE_MASTER			
		)
		
		select a.* from (
			select
				a.project as project,
				b.USE_YN,
				nvl(b.SCRIPTSET,'Normal') SCRIPTSET
			from tbl_project a
			left outer join CORONA_EMMC_PROJECT  b
				on a.project = b.project
			
		) A
		where 1=1
		<choose>
					<when test="filters != null and filters != ''  and filters.rules.size() > 0 " >
			       		<foreach collection="filters.rules" item="item" index="index"  >
			           		and REGEXP_LIKE(${item.field},#{item.data},'i') 
			       		</foreach>
			   		</when>
			   		<otherwise>
			   		</otherwise>
		   		</choose>
		order by a.project
		
	
	</select>
	
	<select id="dashboard.corona.emmc.project.useYn.page" resultType="hashmap">
		with tbl_project as (
			select distinct sample as project from CORONA_EMMC_FIRMWARE_MASTER			
		)
		
		select 
				ceil(count(*)/ #{rows} ) as total,
				#{page} as page ,
				count(*) records 
			from 
			(
				select a.* from (
					select
						a.project as project,
						b.USE_YN,
						b.SCRIPTSET
					from tbl_project a
					left outer join CORONA_EMMC_PROJECT  b
						on a.project = b.project
					order by a.project
			) A
				where 1=1
				<choose>
					<when test="filters != null and filters != ''  and filters.rules.size() > 0 " >
			       		<foreach collection="filters.rules" item="item" index="index"  >
			           		and REGEXP_LIKE(${item.field},#{item.data},'i') 
			       		</foreach>
			   		</when>
			   		<otherwise>
			   		</otherwise>
		   		</choose>
			)
	
	</select>
	
	<update id="dashbaord.corona.emmc.project.useYn.edit" parameterType="hashmap">
    	declare
	    	cnt number;
	    	vUseyn varchar2(10) := #{USE_YN};
	    begin
	    		
	    		select count(*) into cnt from CORONA_EMMC_PROJECT
	    		where PROJECT = #{origindata.PROJECT} ;
	    		
	    		if cnt = 0 then
	    			insert into CORONA_EMMC_PROJECT(PROJECT, USE_YN, SCRIPTSET,  INS_DT)
	    			values (#{origindata.PROJECT},#{USE_YN}, #{SCRIPTSET}, sysdate);
	    		else	    		
	                update CORONA_EMMC_PROJECT set
	                	USE_YN = vUseyn, 
	                	SCRIPTSET = #{SCRIPTSET} ,
	                	MOD_DT = sysdate
	               where PROJECT = #{origindata.PROJECT} ;
	                
	          	end if;
                
       	 
	    end;
    
    </update>
    <select id="dashboard.corona.emmc.summay.firmware.pms" resultType="hashmap">
		select 
			a.SAMPLE,
			a.FIRMWARE,
			b.FW_VERSION
			
		from CORONA_EMMC_FIRMWARE_MASTER A
		join SOLUTIONPMS.FW_RELEASE@Pms_dsbd_inf b
			on REGEXP_REPLACE(a.FIRMWARE,'-([0-9]+)$','') = b.fw_version
			and REGEXP_REPLACE(a.FIRMWARE,'^(.+)-([0-9]+)$','\2') = b.BUILD_NO
			and (SELECT CASE WHEN CODE_ID = 'SPM_00005011' THEN 'eMMC' ELSE 'SSD' END FROM SOLUTIONPMS.PJT_BASE_INFO@Pms_dsbd_inf WHERE CODE_NAME = 'Application' AND PJT_ID = B.PJT_ID) != 'SSD'
			and SOLUTIONPMS.FN_CODE_VALUE_ID@Pms_dsbd_inf(b.VERIFY_RESULT_CD) = 'Pass'
			and SOLUTIONPMS.FN_CODE_VALUE_ID@Pms_dsbd_inf(b.RELEASE_STATUS_CD) != 'Cancelled'
			and NVL(b.OVT_YN, 'N') = 'N'		
		where 1=1
		<if test="project  != null and project != '' ">
		and a.sample = #{project}
		</if>
	
	</select>
	
	
	<select id="dashboard.ssd_sm.manage.scriptsets.search" resultType="hashmap">
		with tbl as (
			select 
				a.SCRIPTSET,
				case a.SCRIPTSET 
					when 'normal' then 0 
					when 'Normal' then 0 
					else 1 
				end as col_order ,
				count(b.SCRIPT_NAME) cnt
			from SSD_SM_SCRIPTSET a
			left outer join SSD_SM_SCRIPTSET_MAP b
				on a.SCRIPTSET = b.SCRIPTSET
			group by a.SCRIPTSET
			order by a.SCRIPTSET
		) 
		
		select * from tbl 
		order by col_order, SCRIPTSET
		
		
	</select>
	
	<select id="dashboard.ssd_sm.manage.scriptsets.map.search.paging" resultType="hashmap">
		Select 
			*		
		From 
		(
			select
				A.*, ROWNUM AS ROW_NUM
			from 
			(
				select 
					a.PROJECT,
					a.FIRMWARE,
					a.FIRMWARE FIRMWARE_NM,
					a.NAND_TYPE, 
					a.REMARK, 
					to_char(a.RELEASE_DATE,'YYYY-MM-DD') as RELEASE_DATE,
					a.SCRIPTSET,
					a.INS_DT, 
					a.MOD_DT
				from SSD_SM_FIRMWARE a		
				where 1=1
				<if test="project  != null and project != '' ">
					and a.PROJECT = #{project}
				</if>
				order by a.project, RELEASE_DATE desc
			) A
			where 1=1 
			
			<choose>
				<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
					and (
					<if test="filters.rules.size() > 0" >
			       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
			           		<if test="index > 0 "> ${filters.groupOp} </if>   REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
			       		</foreach>	
			       	</if>	
			       	<if test="filters.groups != null and filters.groups.size() > 0">
		       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
			       			<if test="group.rules.size() > 0">
			       			${filters.groupOp}
				           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
					        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
					       	</foreach>
					       	</if>
				       	</foreach>
		       		</if> 
		       		 )
		   		</when>
	   		</choose>
	   		   
	   		
		) A
		where
    	<![CDATA[
	    	A.row_num >  to_number(#{rows}) * (to_number(#{page}) -1) 
	    	and A.row_num <= to_number(#{rows}) * to_number(#{page})
    	]]>
		
	</select>
	<select id="dashboard.ssd_sm.manage.scriptsets.map.search.paging.page" resultType="hashmap">
		select 
				ceil(count(*)/ #{rows} ) as total,
				#{page} as page ,
				count(*) records 
			from 
			(
				select a.* from (
					select 
					a.PROJECT,
					a.FIRMWARE,
					a.FIRMWARE FIRMWARE_NM,
					a.NAND_TYPE, 
					a.REMARK, 
					to_char(a.RELEASE_DATE,'YYYY-MM-DD') as RELEASE_DATE,
					a.SCRIPTSET,
					a.INS_DT, 
					a.MOD_DT
				from SSD_SM_FIRMWARE a		
				where 1=1
				<if test="project  != null and project != '' ">
					and a.PROJECT = #{project}
				</if>
				order by a.project, RELEASE_DATE desc
			) A
				where 1=1
				<choose>
					<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
						and (
						<if test="filters.rules.size() > 0" >
				       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
				           		<if test="index > 0 "> ${filters.groupOp} </if>   REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
				       		</foreach>	
				       	</if>	
				       	<if test="filters.groups != null and filters.groups.size() > 0">
			       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
				       			<if test="group.rules.size() > 0">
				       			${filters.groupOp}
					           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
						        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
						       	</foreach>
						       	</if>
					       	</foreach>
			       		</if> 
			       		 )
			   		</when>
	   			</choose>
			)
		
	</select>
	<update id="dashboard.ssd_sm.scriptset.insert" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
	    	
	    		insert into SSD_SM_SCRIPTSET (SCRIPTSET, INS_DT)
                values (#{SCRIPTSET}, sysdate) ;
                
                <if test="copyfrom  != null and copyfrom != '' ">
				delete from SSD_SM_SCRIPTSET_MAP where SCRIPTSET = #{SCRIPTSET};
				
				insert into SSD_SM_SCRIPTSET_MAP (SCRIPTSET, SCRIPT_NAME, INS_DT)
				select 
					#{SCRIPTSET}, SCRIPT_NAME, sysdate
				from SSD_SM_SCRIPTSET_MAP
				where scriptset = #{copyfrom};
				
				</if>
       	 
	    end;
    
    </update>
	<update id="dashboard.ssd_sm.scriptset.delete" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
	    	
	    		if #{origindata.SCRIPTSET} != 'Normal' Then
		    		delete from SSD_SM_SCRIPTSET
		    		where SCRIPTSET = #{origindata.SCRIPTSET} ;
		    		
		    		delete from SSD_SM_SCRIPTSET_MAP
		    		where SCRIPTSET = #{origindata.SCRIPTSET} ;
		    		
		    	
		    	End if;
	    		
	    		
	    end;
    
    </update>
	<update id="dashboard.ssd_sm.scriptset.update" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
	    	if #{origindata.SCRIPTSET} != 'Normal' Then
	    		update SSD_SM_SCRIPTSET set 
	    		SCRIPTSET = #{SCRIPTSET},
	    		mod_dt = sysdate
	    		where SCRIPTSET = #{origindata.SCRIPTSET} ;
	    		
	    		
	    		update SSD_SM_SCRIPTSET_MAP set
	    		SCRIPTSET = #{SCRIPTSET}
	    		where 	SCRIPTSET = #{origindata.SCRIPTSET} ;
	    		
	    		update SSD_SM_SCRIPTSET_MAP_F set
	    		SCRIPTSET = #{SCRIPTSET}
	    		where 	SCRIPTSET = #{origindata.SCRIPTSET} ;
	    		
	    		
               end if;
       	 
	    end;
    
    </update>
	<select id="dashboard.ssd_sm.search.project" resultType="hashmap">
		select
			PROJECT, 
			SCRIPTSET, 
			USE_YN,
			INS_DT, 
			MOD_DT
		from SSD_SM_PROJECT
		where use_yn != 'N'
		order by project
	
	</select>
	<update id="dashboard.ssd_sm.firmware.insert" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
	    	
	    		insert into SSD_SM_FIRMWARE (PROJECT, FIRMWARE, NAND_TYPE, REMARK, RELEASE_DATE, SCRIPTSET,INS_DT)
                values (#{PROJECT},#{FIRMWARE},#{NAND_TYPE},#{REMARK},#{RELEASE_DATE},#{SCRIPTSET}, sysdate) ;
       	 
	    end;
    
    </update>
    
    <update id="dashboard.ssd_sm.firmware.update" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
	    	select count(*) into cnt from SSD_SM_FIRMWARE 
	    	where project = #{origindata.PROJECT}
	    	and firmware = #{origindata.FIRMWARE};
	    	
	    	update SSD_SM_FIRMWARE set
		    	MOD_DT = sysdate
		    	<if test="NAND_TYPE != origindata.NAND_TYPE">,NAND_TYPE = #{NAND_TYPE}</if>
		    	<if test="REMARK != origindata.REMARK">,REMARK = #{REMARK}</if>
		    	<if test="RELEASE_DATE != origindata.RELEASE_DATE">,RELEASE_DATE = to_date(#{RELEASE_DATE},'YYYY-MM-DD')</if>
		    	<if test="SCRIPTSET != origindata.SCRIPTSET">,SCRIPTSET = #{SCRIPTSET}</if>
		 
	    	where project = #{origindata.PROJECT}
	    	and firmware = #{origindata.FIRMWARE};
	    	
	    end;
    
    </update>
    <update id="dashboard.ssd_sm.firmware.delete" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
	    	
	    	delete from SSD_SM_FIRMWARE 		 
	    	where project = #{origindata.PROJECT}
	    	and firmware = #{origindata.FIRMWARE};
	    	
	    end;
    
    </update>
	
	<select id="dashboard.ssd_sm.project" resultType="hashmap">
		Select 
			*		
		From 
		(
			select
				A.*, ROWNUM AS ROW_NUM
			from 
			(
				select 
					a.PROJECT,
					a.SCRIPTSET,
					a.USE_YN,
					a.INS_DT, 
					a.MOD_DT
				from SSD_SM_PROJECT a		
				where 1=1
				order by a.project, ins_dt desc
			) A
			where 1=1 
			
			<choose>
				<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
					and (
					<if test="filters.rules.size() > 0" >
			       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
			           		<if test="index > 0 "> ${filters.groupOp} </if>   REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
			       		</foreach>	
			       	</if>	
			       	<if test="filters.groups != null and filters.groups.size() > 0">
		       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
			       			<if test="group.rules.size() > 0">
			       			${filters.groupOp}
				           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
					        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
					       	</foreach>
					       	</if>
				       	</foreach>
		       		</if> 
		       		 )
		   		</when>
	   		</choose>
	   		   
	   		
		) A
		where
    	<![CDATA[
	    	A.row_num >  to_number(#{rows}) * (to_number(#{page}) -1) 
	    	and A.row_num <= to_number(#{rows}) * to_number(#{page})
    	]]>
		
	
	</select>
	
	<select id="dashboard.ssd_sm.project.page" resultType="hashmap">
		select 
				ceil(count(*)/ #{rows} ) as total,
				#{page} as page ,
				count(*) records 
			from 
			(
				select a.* from (
					select 
						a.PROJECT,
						a.SCRIPTSET,
						a.USE_YN,
						a.INS_DT, 
						a.MOD_DT
					from SSD_SM_PROJECT a		
					where 1=1
					order by a.project, ins_dt desc
			) A
				where 1=1
				<choose>
					<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
						and (
						<if test="filters.rules.size() > 0" >
				       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
				           		<if test="index > 0 "> ${filters.groupOp} </if>   REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
				       		</foreach>	
				       	</if>	
				       	<if test="filters.groups != null and filters.groups.size() > 0">
			       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
				       			<if test="group.rules.size() > 0">
				       			${filters.groupOp}
					           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
						        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
						       	</foreach>
						       	</if>
					       	</foreach>
			       		</if> 
			       		 )
			   		</when>
	   			</choose>
			)
	
	</select>
    <update id="dashbaord.ssd_sm.project.edit" parameterType="hashmap">
    	declare
	    	cnt number;
	    	vUseyn varchar2(10) := #{USE_YN};
	    begin
	    		
	    		select count(*) into cnt from SSD_SM_PROJECT
	    		where PROJECT = #{origindata.PROJECT} ;
	    		
	    		if cnt = 0 then
	    			insert into SSD_SM_PROJECT(PROJECT, USE_YN, SCRIPTSET,  INS_DT)
	    			values (#{origindata.PROJECT},#{USE_YN}, #{SCRIPTSET}, sysdate);
	    		else	    		
	                update SSD_SM_PROJECT set
	                	USE_YN = vUseyn, 
	                	SCRIPTSET = #{SCRIPTSET} ,
	                	MOD_DT = sysdate
	               where PROJECT = #{origindata.PROJECT} ;
	                
	          	end if;
                
       	 
	    end;
    
    </update>
    <update id="dashboard.ssd_sm.project.insert" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
	    	
	    		insert into SSD_SM_PROJECT(PROJECT, USE_YN, SCRIPTSET,  INS_DT)
	    		values (#{PROJECT},#{USE_YN}, #{SCRIPTSET}, sysdate);
       	 
	    end;
    
    </update>
    <update id="dashboard.ssd_sm.project.delete" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
	    	
	    	delete from SSD_SM_PROJECT		 
	    	where project = #{origindata.PROJECT};
	    	
	    end;
    
    </update>
    
    <select id="dashboard.ssd_sm.script.category.distinct" resultType="hashmap">
		select
			distinct category,  'SELECTED' selected
		from SSD_SM_MASTER
		order by 1
	
	</select>
    <select id="dashboard.ssd_sm.script.sub_category.distinct" resultType="hashmap">
		select
			distinct CATEGORY, SUB_CATEGORY , 'SELECTED' selected
		from SSD_SM_MASTER
		order by 1
	
	</select>
	<select id="dashboard.ssd_sm.manage.script.search" resultType="hashmap">
			with tbl_a as (	
				SELECT
						a.SCRIPT_NAME, 
						a.STAGE, 
						b.SCRIPT_GROUP,
						b.GROUP_NAME,
						b.seq,
						a.CATEGORY, 
						row_number() over (partition by b.SCRIPT_GROUP, a.category order by b.seq,a.CATEGORY,a.SCRIPT_NAME) row_num,
						a.SUB_CATEGORY, 
						a.ITEM, 
						a.SUB_ITEM, 
						substr(a.DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
						a.DESCRIPTION,
						a.TESTER, 
						a.INS_DT, 
						a.MOD_DT				
					from SSD_SM_MASTER a
					left outer join SSD_SM_MASTER_GROUP b
						on b.SCRIPT_GROUP = a.SCRIPT_GROUP
					where 1=1
					<if test="stageArr  != null and stageArr != '' ">
						and a.stage in 
						<foreach collection="stageArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="scriptGroupArr  != null and scriptGroupArr != '' ">
						and b.script_group in 
						<foreach collection="scriptGroupArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="categoryArr  != null and categoryArr != '' ">
						and a.category in 
						<foreach collection="categoryArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="subCategoryArr  != null and subCategoryArr != '' ">
						and a.SUB_CATEGORY in 
						<foreach collection="subCategoryArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="testItemArr  != null and testItemArr != '' ">
						and a.item in 
						<foreach collection="testItemArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					--order by category,test_item, script_name
					order by b.seq,category ,script_name
				)
				
				select 
					case 
						when a.row_num > 0 and a.row_num <![CDATA[ <= ]]>  500 then '01. ~500'
						when a.row_num >500 and a.row_num <![CDATA[ <=  ]]> 1000 then '02. 500~1000'
						when a.row_num > 1000 and a.row_num <![CDATA[ <=  ]]> 1500 then '03. 1000~1500'
						when a.row_num > 1500 and a.row_num <![CDATA[ <=  ]]> 2000 then '04. 1500~2000'
						when a.row_num > 2000 then '05. 2000~'				
					end as rownum_grp
					,a.*
				from tbl_a a
				
	
	</select>
	<select id="dashboard.ssd_sm.manage.script.search.paging" resultType="hashmap">
		Select
			*		
		From 
		(
			select
				A.*, ROWNUM AS ROW_NUM
			from 
			(		
				SELECT
						a.SCRIPT_NAME, 
						a.STAGE,
						b.SCRIPT_GROUP,
						b.GROUP_NAME,
						a.CATEGORY, 
						a.SUB_CATEGORY, 
						a.ITEM, 
						a.SUB_ITEM, 
						substr(a.DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
						a.DESCRIPTION,
						a.TESTER, 
						a.INS_DT, 
						a.MOD_DT				
					from SSD_SM_MASTER a
					left outer join SSD_SM_MASTER_GROUP b
						on b.SCRIPT_GROUP = a.SCRIPT_GROUP
					where 1=1
					<if test="stageArr  != null and stageArr != '' ">
						and a.stage in 
						<foreach collection="stageArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="scriptGroupArr  != null and scriptGroupArr != '' ">
						and a.script_group in 
						<foreach collection="scriptGroupArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="categoryArr  != null and categoryArr != '' ">
						and a.category in 
						<foreach collection="categoryArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="subCategoryArr  != null and subCategoryArr != '' ">
						and a.SUB_CATEGORY in 
						<foreach collection="subCategoryArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="testItemArr  != null and testItemArr != '' ">
						and a.item in 
						<foreach collection="testItemArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					--order by category,test_item, script_name
					order by b.seq,a.category ,a.script_name
				) A
			where 1=1 			
			<choose>
				<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
					and (
					<if test="filters.rules.size() > 0" >
			       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
			           		<if test="index > 0 "> ${filters.groupOp} </if>   REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
			       		</foreach>	
			       	</if>	
			       	<if test="filters.groups != null and filters.groups.size() > 0">
		       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
			       			<if test="group.rules.size() > 0">
			       			${filters.groupOp}
				           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
					        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
					       	</foreach>
					       	</if>
				       	</foreach>
		       		</if> 
		       		 )
		   		</when>
	   		</choose>
	   		   
	   		
		) A
		where
    	<![CDATA[
	    	A.row_num >  to_number(#{rows}) * (to_number(#{page}) -1) 
	    	and A.row_num <= to_number(#{rows}) * to_number(#{page})
    	]]>
	</select>
	<select id="dashboard.ssd_sm.manage.script.search.paging.page" resultType="hashmap">
		select 
			ceil(count(*)/ #{rows} ) as total,
			#{page} as page ,
			count(*) records 
		from 
		(
			select a.* from (		
				SELECT
						a.SCRIPT_NAME, 
						a.STAGE,
						b.SCRIPT_GROUP,
						b.GROUP_NAME,
						a.CATEGORY, 
						a.SUB_CATEGORY, 
						a.ITEM, 
						a.SUB_ITEM, 
						substr(a.DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
						a.DESCRIPTION,
						a.TESTER, 
						a.INS_DT, 
						a.MOD_DT				
					from SSD_SM_MASTER a
					left outer join SSD_SM_MASTER_GROUP b
						on b.SCRIPT_GROUP = a.SCRIPT_GROUP
					where 1=1 and 2=2
					<if test="stageArr  != null and stageArr != '' ">
						and a.stage in 
						<foreach collection="stageArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="scriptGroupArr  != null and scriptGroupArr != '' ">
						and a.script_group in 
						<foreach collection="scriptGroupArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="categoryArr  != null and categoryArr != '' ">
						and a.category in 
						<foreach collection="categoryArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="subCategoryArr  != null and subCategoryArr != '' ">
						and a.SUB_CATEGORY in
						<foreach collection="subCategoryArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="testItemArr  != null and testItemArr != '' ">
						and a.item in 
						<foreach collection="testItemArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					--order by category,test_item, script_name
					order by b.seq,a.category ,a.script_name
				) A
			where 1=1 			
			<choose>
				<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
					and (
					<if test="filters.rules.size() > 0" >
			       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
			           		<if test="index > 0 "> ${filters.groupOp} </if>   REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
			       		</foreach>	
			       	</if>	
			       	<if test="filters.groups != null and filters.groups.size() > 0">
		       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
			       			<if test="group.rules.size() > 0">
			       			${filters.groupOp}
				           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
					        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
					       	</foreach>
					       	</if>
				       	</foreach>
		       		</if> 
		       		 )
		   		</when>
	   		</choose>
	   		   
	   		
		) A
		
	</select>
	<select id="dashboard.ssd_sm.autocomplete.script" resultType="hashmap">
		select
			distinct ${field} "id", ${field} "name"
		from SSD_SM_MASTER
		where REGEXP_LIKE(${field} ,#{term},'i')  
		
		order by 1
	
	</select>
	<select id="dashboard.ssd_sm.manage.script.search.one" resultType="hashmap">
		select	
			a.SCRIPT_NAME, 
			b.SCRIPT_GROUP,
			b.GROUP_NAME,
			a.STAGE, 
			a.CATEGORY, 
			a.SUB_CATEGORY, 
			a.ITEM, 
			a.SUB_ITEM, 
			substr(a.DESCRIPTION,1,20) || ' ...'  as  DESCRIPTION_SIMPLE, 
			a.DESCRIPTION,
			a.TESTER, 
			a.INS_DT, 
			a.MOD_DT				
		from SSD_SM_MASTER a
		left outer join SSD_SM_MASTER_GROUP b
			on b.SCRIPT_GROUP = a.SCRIPT_GROUP
		where script_name = #{script_name}
	
	</select>
	<update id="dashboard.ssd_sm.script_master.insert" parameterType="hashmap" >
    	declare
	    	cnt number;
	    	v_status varchar2(100);
	    begin
	    	
    		insert into SSD_SM_MASTER (SCRIPT_NAME, SCRIPT_GROUP, STAGE, CATEGORY, SUB_CATEGORY, ITEM, SUB_ITEM, INS_DT)
            values (#{SCRIPT_NAME}, #{SCRIPT_GROUP}, #{STAGE}, #{CATEGORY}, #{SUB_CATEGORY}, #{ITEM}, #{SUB_ITEM}, sysdate) ;
                
            select count(*) into cnt from SSD_SM_SCRIPTSET_MAP
            where SCRIPTSET = 'Normal'
            and SCRIPT_NAME = #{SCRIPT_NAME};
            
            if cnt = 0 then
            	insert into SSD_SM_SCRIPTSET_MAP (SCRIPTSET, SCRIPT_NAME,INS_DT)
            	values ('Normal', #{SCRIPT_NAME}, sysdate);
            end if;
       	 
	    end;
    
    </update>
    <update id="dashboard.ssd_sm.script_master.delete" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
	    	
	    		delete from SSD_SM_MASTER
	    		where 1=1
	    		and SCRIPT_NAME = #{detail.SCRIPT_NAME};
	    		
	    		--// 01. delete script set
	    		delete from SSD_SM_SCRIPTSET_MAP
	    		where 1=1
	    		and SCRIPT_NAME = #{detail.SCRIPT_NAME};
	    		
	    end;
    
    </update>
    <update id="dashboard.ssd_sm.script_master.update" parameterType="hashmap" >
    	declare
	    	cnt number;
	    	v_script_name varchar2(2000);
	    	v_convert_script varchar2(2000);
	    	v_status varchar2(10);
	    begin
	    	
	    		select count(*) into cnt from SSD_SM_MASTER
	    		where 1=1
	    		<choose>
						<when test="searchJson != null and searchJson != '' and searchJson.origindatas.size() > 0 " >
			       		<foreach collection="searchJson.origindatas" item="item" index="index"  >
			       			and ${item.field} = #{item.value}
			       		</foreach>
			   		</when>
			   		<otherwise>
			   			and 1=2
			   		</otherwise>
		   		</choose>   
	    		;
	    		
	    		if cnt = 1 then
	    			update SSD_SM_MASTER set
	              	${fieldName} = #{fieldValue},	  
	              	MOD_DT = sysdate
	              	where 1=1
		    		<choose>
						<when test="searchJson != null and searchJson != '' and searchJson.origindatas.size() > 0 " >
				       		<foreach collection="searchJson.origindatas" item="item" index="index"  >
				       			and ${item.field} = #{item.value}
				       		</foreach>
				   		</when>
				   		<otherwise>
				   			and 1=2
				   		</otherwise>
			   		</choose>          	
	          		;
	          		
	          		
	          		<if test= "fieldName == 'SCRIPT_NAME' ">
	          			v_script_name := #{fieldValue};   
	          			
	          			--// update SSD_SM_SCRIPTSET_MAP
	          			 update SSD_SM_SCRIPTSET_MAP set
	          			 SCRIPT_NAME = #{fieldValue},
	          			 MOD_DT = sysdate
	          			 where SCRIPT_NAME = #{fieldValueOrigin};
	          		
	          			--// update_log_table
	          			update SSD_SM_RESULT set
	          			SCRIPT_NAME = #{fieldValue},
	          			MOD_DT = sysdate
	          			where SCRIPT_NAME = #{fieldValueOrigin};
	          			
		          		
	          		</if>
	          		
	          		
	          		
			         
	        	end if;
                
       	 
	    end;
    
    </update>
    <select id="dashboard.ssd_sm.manage.scriptset_script_map.search" resultType="hashmap">
    	with tbl_a as (	
			select 
					a.SCRIPTSET,
					a.SCRIPT_NAME, 
					b.STAGE, 
					c.SCRIPT_GROUP,
					c.GROUP_NAME,
					c.SEQ,
					b.CATEGORY, 
					row_number() over (partition by c.SCRIPT_GROUP, b.category order by c.seq,b.CATEGORY ,b.SCRIPT_NAME) row_num,
					b.SUB_CATEGORY, 
					b.ITEM, 
					b.SUB_ITEM, 
					b.DESCRIPTION, 
					b.TESTER, 
					a.INS_DT, 
					a.MOD_DT
				from SSD_SM_SCRIPTSET_MAP a		
				left outer join SSD_SM_MASTER b
					on a.script_name = b.script_name
				left outer join SSD_SM_MASTER_GROUP c
						on c.SCRIPT_GROUP = b.SCRIPT_GROUP
				where 1=1
				<if test="search_scriptset  != null and search_scriptset != '' ">
					and a.SCRIPTSET = #{search_scriptset}
				</if>
				order by 
					c.SEQ ,
					b.CATEGORY, 
					b.SUB_CATEGORY, 
					b.ITEM, 
					b.SUB_ITEM, 
					b.SCRIPT_NAME
			)
			
			select 
				case 
					when a.row_num > 0 and a.row_num <![CDATA[ <= ]]>  500 then '01. ~500'
					when a.row_num >500 and a.row_num <![CDATA[ <=  ]]> 1000 then '02. 500~1000'
					when a.row_num > 1000 and a.row_num <![CDATA[ <=  ]]> 1500 then '03. 1000~1500'
					when a.row_num > 1500 and a.row_num <![CDATA[ <=  ]]> 2000 then '04. 1500~2000'
					when a.row_num > 2000 then '05. 2000~'				
				end as rownum_grp
				,a.*
			from tbl_a a
    </select>
	<select id="dashboard.ssd_sm.manage.scriptset_script_map.search.paging" resultType="hashmap">
		Select 
			*		
		From 
		(
			select
				A.*, ROWNUM AS ROW_NUM
			from 
			(
				select 
					a.SCRIPTSET,
					a.SCRIPT_NAME, 
					b.STAGE, 
					c.SCRIPT_GROUP,
					c.GROUP_NAME,
					c.SEQ,
					b.CATEGORY, 
					b.SUB_CATEGORY, 
					b.ITEM, 
					b.SUB_ITEM, 
					b.DESCRIPTION, 
					b.TESTER, 
					a.INS_DT, 
					a.MOD_DT
				from SSD_SM_SCRIPTSET_MAP a		
				left outer join SSD_SM_MASTER b
					on a.script_name = b.script_name
				left outer join SSD_SM_MASTER_GROUP c
						on c.SCRIPT_GROUP = b.SCRIPT_GROUP
				where 1=1
				<if test="search_scriptset  != null and search_scriptset != '' ">
					and a.SCRIPTSET = #{search_scriptset}
				</if>
				<if test="stageArr  != null and stageArr != '' ">
					and b.stage in 
					<foreach collection="stageArr" item="item" index="index" open="(" separator="," close=")" >
		       			#{item}
		       		</foreach>
				</if>
				<if test="scriptGroupArr  != null and scriptGroupArr != '' ">
					and c.script_group in 
					<foreach collection="scriptGroupArr" item="item" index="index" open="(" separator="," close=")" >
		       			#{item}
		       		</foreach>
				</if>
				<if test="categoryArr  != null and categoryArr != '' ">
					and b.category in 
					<foreach collection="categoryArr" item="item" index="index" open="(" separator="," close=")" >
		       			#{item}
		       		</foreach>
				</if>
				<if test="subCategoryArr  != null and subCategoryArr != '' ">
					and b.SUB_CATEGORY in 
					<foreach collection="subCategoryArr" item="item" index="index" open="(" separator="," close=")" >
		       			#{item}
		       		</foreach>
				</if>
				order by c.seq , 
					b.CATEGORY, 
					b.SUB_CATEGORY, 
					b.ITEM, 
					b.SUB_ITEM, 
					b.SCRIPT_NAME
			) A
			where 1=1 
			
			<choose>
				<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
					and (
					<if test="filters.rules.size() > 0" >
			       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
			           		<if test="index > 0 "> ${filters.groupOp} </if>   REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
			       		</foreach>	
			       	</if>	
			       	<if test="filters.groups != null and filters.groups.size() > 0">
		       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
			       			<if test="group.rules.size() > 0">
			       			${filters.groupOp}
				           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
					        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
					       	</foreach>
					       	</if>
				       	</foreach>
		       		</if> 
		       		 )
		   		</when>
	   		</choose>
	   		   
	   		
		) A
		where
    	<![CDATA[
	    	A.row_num >  to_number(#{rows}) * (to_number(#{page}) -1) 
	    	and A.row_num <= to_number(#{rows}) * to_number(#{page})
    	]]>
		
	</select>
	<select id="dashboard.ssd_sm.manage.scriptset_script_map.search.paging.page" resultType="hashmap">
		select 
				ceil(count(*)/ #{rows} ) as total,
				#{page} as page ,
				count(*) records 
			from 
			(
				select a.* from (
					select 
						a.SCRIPTSET,
						a.SCRIPT_NAME, 
						b.STAGE, 
						c.SCRIPT_GROUP,
						c.GROUP_NAME,
						c.SEQ,
						b.CATEGORY, 
						b.SUB_CATEGORY, 
						b.ITEM, 
						b.SUB_ITEM, 
						b.DESCRIPTION, 
						b.TESTER, 
						a.INS_DT, 
						a.MOD_DT
					from SSD_SM_SCRIPTSET_MAP a		
					left outer join SSD_SM_MASTER b
						on a.script_name = b.script_name
					left outer join SSD_SM_MASTER_GROUP c
						on c.SCRIPT_GROUP = b.SCRIPT_GROUP
					where 1=1
					<if test="search_scriptset  != null and search_scriptset != '' ">
						and a.SCRIPTSET = #{search_scriptset}
					</if>
					<if test="stageArr  != null and stageArr != '' ">
						and b.stage in 
						<foreach collection="stageArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="scriptGroupArr  != null and scriptGroupArr != '' ">
						and c.script_group in 
						<foreach collection="scriptGroupArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="categoryArr  != null and categoryArr != '' ">
						and b.category in 
						<foreach collection="categoryArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					<if test="subCategoryArr  != null and subCategoryArr != '' ">
						and b.SUB_CATEGORY in 
						<foreach collection="subCategoryArr" item="item" index="index" open="(" separator="," close=")" >
			       			#{item}
			       		</foreach>
					</if>
					order by 
						c.seq,
						b.CATEGORY, 
						b.SUB_CATEGORY, 
						b.ITEM, 
						b.SUB_ITEM, 
						b.SCRIPT_NAME
			) A
				where 1=1
				<choose>
					<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
						and (
						<if test="filters.rules.size() > 0" >
				       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
				           		<if test="index > 0 "> ${filters.groupOp} </if>   REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
				       		</foreach>	
				       	</if>	
				       	<if test="filters.groups != null and filters.groups.size() > 0">
			       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
				       			<if test="group.rules.size() > 0">
				       			${filters.groupOp}
					           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
						        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
						       	</foreach>
						       	</if>
					       	</foreach>
			       		</if> 
			       		 )
			   		</when>
	   			</choose>
			)
		
	</select>
    <update id="dashboard.ssd_sm.scriptset_script_map.delete" parameterType="hashmap" >
    	declare
	    	cnt number;
	    begin
    		delete from SSD_SM_SCRIPTSET_MAP
    		where SCRIPTSET = #{origindata.SCRIPTSET} 
    		and SCRIPT_NAME = #{origindata.SCRIPT_NAME} 
	    		
	    end;
    
    </update>
	<select id="dashboard.ssd_sm.historyno" resultType="hashmap">
		SELECT LPAD(TO_NUMBER(nvl(max(HISTORY_NO),'0'))+1, 10,'0') HISTORY_NO from  SSD_SM_HISTORY_NO
    </select>
	<update id="dashboard.ssd_sm.manage.insert.historyno.copy_template_scriptset" parameterType="hashmap" >
    	DECLARE
	    	cnt number;
	    	v_history_no varchar2(100) := #{history_no};
	    BEGIN
	    	INSERT INTO SSD_SM_HISTORY_NO (HISTORY_NO, INS_DT, TYPE, USER_COMMENT) 
	    	VALUES (v_history_no , sysdate,'COPY', 'scriptset_copy_from_master' );
	    	
	    	insert into SSD_SM_SCRIPTSET_MAP_H (HISTORY_NO, SCRIPTSET, SCRIPT_NAME, INS_DT, MOD_DT)
	    		select 
	    			v_history_no,
	    			SCRIPTSET,
	    			SCRIPT_NAME,
	    			INS_DT, 
	    			MOD_DT
	    		from SSD_SM_SCRIPTSET_MAP
	    		where 1=1
	    		and scriptset = #{searchJson.target.scriptset}
	    		 ;
	    		 
	    End;
    </update>
    <update id="dashboard.ssd_smc.manage.script_copy_scriptset.update" parameterType="hashmap" >
    	DECLARE
	    	cnt number;
	    	v_history_no varchar2(100) := #{history_no};
	    	v_status varchar2(10);
	    BEGIN
	    		
	    	--// Revision Start	    		
	    	For rec_firmware in (
	    		select distinct SCRIPTSET from SSD_SM_SCRIPTSET where SCRIPTSET = #{searchJson.target.scriptset} 
	    	) Loop
	    		
	    		--// second Loop
	    		FOR rec in (
	    			select * from SSD_SM_MASTER
					where 1=1
					and script_name = #{detail.SCRIPT_NAME}    			
	    		) LOOP 
			    			
					select count(*) into cnt from SSD_SM_SCRIPTSET_MAP
					where SCRIPTSET = rec_firmware.SCRIPTSET
					and script_name = rec.SCRIPT_NAME;
					
					IF cnt = 0 THEN
						insert into SSD_SM_SCRIPTSET_MAP (SCRIPTSET, SCRIPT_NAME, INS_DT)
						values (
							rec_firmware.SCRIPTSET 
							, rec.SCRIPT_NAME
							, sysdate
						);
					END IF;
					
				End Loop;
	    	
	    	End Loop;
	    	 
	 			
	    END;
    
    </update>
    <select id="dashboard.ssd_sm.script.group.list" resultType="hashmap">
    	select
    		SCRIPT_GROUP,
    		GROUP_NAME, 
    		SEQ,
    		'selected' SELECTED
    	from SSD_SM_MASTER_GROUP
    	order by SEQ
    </select>
    
    <select id="dashboard.ssd_sm.summary.all" resultType="hashmap">
		with tbl_list as (
			select 
			f.PROJECT,
			f.FIRMWARE,		
			count(sm.SCRIPT_NAME) TOTAL,
			(
				select count(*) cnt from SSD_SM_RESULT rt 
				where rt.PROJECT = f.PROJECT
				and rt.FIRMWARE = f.FIRMWARE
				and rt.status = 'PASSED'
			) PASSED,
			(
				select count(*) cnt from SSD_SM_RESULT rt 
				where rt.PROJECT = f.PROJECT
				and rt.FIRMWARE = f.FIRMWARE
				and rt.status = 'FAILED'
			) FAILED,
			(
				select count(*) cnt from SSD_SM_RESULT rt 
				where rt.PROJECT = f.PROJECT
				and rt.FIRMWARE = f.FIRMWARE
				and rt.status = 'ING'
			) ING,
			(
				select count(*) cnt from SSD_SM_RESULT rt 
				where rt.PROJECT = f.PROJECT
				and rt.FIRMWARE = f.FIRMWARE
				and rt.status = 'PENDING'
			) PENDING,
			(
				select count(*) cnt from SSD_SM_RESULT rt 
				where rt.PROJECT = f.PROJECT
				and rt.FIRMWARE = f.FIRMWARE
				and rt.status = 'N/A'
			) "N/A"
			
			
		from SSD_SM_FIRMWARE f
		left outer join SSD_SM_SCRIPTSET_MAP sm
			on sm.SCRIPTSET = f.SCRIPTSET
		left outer join SSD_SM_MASTER m
			on m.script_name = sm.script_name
		left outer join SSD_SM_RESULT r
			on r.PROJECT = f.PROJECT
			and r.FIRMWARE = f.FIRMWARE
			and r.SCRIPT_NAME = sm.SCRIPT_NAME
		where 1=1
		<if test="stageArr  != null and stageArr != '' ">
			and m.stage in 
			<foreach collection="stageArr" item="item" index="index" open="(" separator="," close=")" >
       			#{item}
       		</foreach>
		</if>
		group by f.PROJECT, f.FIRMWARE
		), 
		tbl_list1 as ( 
			select 
				a.*
				, a.total - ( a.passed + a.failed + a.ing + a.pending + a."N/A") as blank
			from tbl_list a
		) 

		select
			   COUNT(*) OVER() AS totcnt
			, a.project
			, a.FIRMWARE
			, f.NAND_TYPE
			, f.REMARK
			, to_char(f.RELEASE_DATE,'YYYY-MM-DD') as RELEASE_DATE
			, f.SCRIPTSET
			, a.TOTAL
			, a.BLANK
			, case a.total when 0 then 0 else a.blank/a.total end as BLANK_RATIO
			, a.PASSED
			, case a.total when 0 then 0 else a.PASSED/a.total end as PASSED_RATIO
			, a.FAILED
			, case a.total when 0 then 0 else a.failed/a.total  end as FAILED_RATIO
			, a.ING
			, case a.total when 0 then 0 else a.ing/a.total end as ING_RATIO
			, a.PENDING
			, case a.total when 0 then 0 else a.pending/a.total end as PENDING_RATIO
			, a."N/A" as NA
			, case a.total when 0 then 0 else a."N/A"/a.total end as NA_RATIO
			
		from tbl_list1 a
		left outer join SSD_SM_FIRMWARE f
			on f.project = a.project
			and f.firmware = a.firmware
		order by a.project, a.firmware
    </select>
    <select id="dashboard.ssd_sm.summary.firmware" resultType="hashmap">
		with tbl_list as (
			select 
			f.PROJECT,
			f.FIRMWARE,		
			m.SCRIPT_GROUP,
			count(sm.SCRIPT_NAME) TOTAL,
			(
				select count(*) cnt 
				from SSD_SM_RESULT rt
				join SSD_SM_MASTER tsm 
					on rt.script_name= tsm.script_name
					
				where rt.PROJECT = f.PROJECT
				and rt.FIRMWARE = f.FIRMWARE
				and rt.status = 'PASSED'
				and m.SCRIPT_GROUP = tsm.SCRIPT_GROUP
				
			) PASSED,
			(
				select count(*) cnt
				from SSD_SM_RESULT rt
				join SSD_SM_MASTER tsm 
					on rt.script_name= tsm.script_name
					
				where rt.PROJECT = f.PROJECT
				and rt.FIRMWARE = f.FIRMWARE
				and rt.status = 'FAILED'
				and m.SCRIPT_GROUP = tsm.SCRIPT_GROUP
			) FAILED,
			(
				select count(*) cnt 
				from SSD_SM_RESULT rt
				join SSD_SM_MASTER tsm 
					on rt.script_name= tsm.script_name
					
				where rt.PROJECT = f.PROJECT
				and rt.FIRMWARE = f.FIRMWARE
				and rt.status = 'ING'
				and m.SCRIPT_GROUP = tsm.SCRIPT_GROUP
			) ING,
			(
				select count(*) cnt 
				from SSD_SM_RESULT rt
				join SSD_SM_MASTER tsm 
					on rt.script_name= tsm.script_name
					
				where rt.PROJECT = f.PROJECT
				and rt.FIRMWARE = f.FIRMWARE
				and rt.status = 'PENDING'
				and m.SCRIPT_GROUP = tsm.SCRIPT_GROUP
			) PENDING,
			(
				select count(*) cnt 
				from SSD_SM_RESULT rt
				join SSD_SM_MASTER tsm 
					on rt.script_name= tsm.script_name
					
				where rt.PROJECT = f.PROJECT
				and rt.FIRMWARE = f.FIRMWARE
				and rt.status = 'N/A'
				and m.SCRIPT_GROUP = tsm.SCRIPT_GROUP
			) "N/A"
			
			
		from SSD_SM_FIRMWARE f
		join SSD_SM_SCRIPTSET_MAP sm
			on sm.SCRIPTSET = f.SCRIPTSET
		join SSD_SM_MASTER m
			on m.script_name = sm.script_name
		left outer join SSD_SM_RESULT r
			on r.PROJECT = f.PROJECT
			and r.FIRMWARE = f.FIRMWARE
			and r.SCRIPT_NAME = sm.SCRIPT_NAME
		where 1=1
		and f.firmware = #{search_firmware}
		<if test="stageArr  != null and stageArr != '' ">
			and m.stage in 
			<foreach collection="stageArr" item="item" index="index" open="(" separator="," close=")" >
       			#{item}
       		</foreach>
		</if>
		group by f.PROJECT, f.FIRMWARE , m.SCRIPT_GROUP
		), 
		tbl_list1 as ( 
			select 
				a.*
				, a.total - ( a.passed + a.failed + a.ing + a.pending + a."N/A") as blank
			from tbl_list a
		) 

		select 
			a.project
			, a.FIRMWARE
			, a.SCRIPT_GROUP
			, mg.GROUP_NAME
			, f.NAND_TYPE
			, f.REMARK
			, to_char(f.RELEASE_DATE,'YYYY-MM-DD') as RELEASE_DATE
			, f.SCRIPTSET
			, a.TOTAL
			, a.BLANK
			, case a.total when 0 then 0 else  a.blank/a.total end as BLANK_RATIO
			, a.PASSED
			, case a.total when 0 then 0 else a.PASSED/a.total end as PASSED_RATIO
			, a.FAILED
			, case a.total when 0 then 0 else a.failed/a.total  end as FAILED_RATIO
			, a.ING
			, case a.total when 0 then 0 else a.ing/a.total end as ING_RATIO
			, a.PENDING
			, case a.total when 0 then 0 else a.pending/a.total end as PENDING_RATIO
			, a."N/A" as NA
			, case a.total when 0 then 0 else a."N/A"/a.total end as NA_RATIO
			
		from tbl_list1 a
		left outer join SSD_SM_FIRMWARE f
			on f.project = a.project
			and f.firmware = a.firmware
		left outer join SSD_SM_MASTER_GROUP mg
			on mg.SCRIPT_GROUP = a.SCRIPT_GROUP
		order by mg.seq
    </select>    
    <select id="dashboard.ssd_sm.detail.paging" resultType="hashmap">
    	Select 
			*		
		From 
		(
			select
				A.*, ROWNUM AS ROW_NUM
			from 
			(
		    	select 
					f.PROJECT,
					f.FIRMWARE,	
					m.SCRIPT_NAME,	
					m.SCRIPT_GROUP,
					m.STAGE, 
					m.CATEGORY, 
					m.SUB_CATEGORY, 
					m.ITEM, 
					m.SUB_ITEM, 
					m.DESCRIPTION, 
					m.TESTER,
					-- r.SCRIPT_NAME,
					to_char(r.START_DT,'YYYY-MM-DD') as START_DT, 
					to_char(r.END_DT,'YYYY-MM-DD') as END_DT, 
					r.STATUS, 
					r.REMARK, 
					r.ASSIGNEE, 
					r.INS_DT, 
					r.MOD_DT
					
				from SSD_SM_FIRMWARE f
				join SSD_SM_SCRIPTSET_MAP sm
					on sm.SCRIPTSET = f.SCRIPTSET
				join SSD_SM_MASTER m
					on m.script_name = sm.script_name
				left outer join SSD_SM_RESULT r
					on r.PROJECT = f.PROJECT
					and r.FIRMWARE = f.FIRMWARE
					and r.SCRIPT_NAME = sm.SCRIPT_NAME
				where 1=1
				and f.firmware = #{search_firmware}
				<if test="countGubun != null and countGubun != '' and countGubun == 'BLANK'  " > and r.STATUS is null</if>
				<if test="countGubun != null and countGubun != '' and countGubun != 'BLANK' and countGubun != 'TOTAL'  " > and r.STATUS =  #{countGubun} </if>
				<if test="scriptGroup != null and scriptGroup != '' " > and m.SCRIPT_GROUP  = #{scriptGroup}</if>
				<if test="stageArr  != null and stageArr != '' ">
				and m.stage in
				<foreach collection="stageArr" item="item" index="index" open="(" separator="," close=")" >#{item}</foreach>
				</if>
				order by m.STAGE, m.SCRIPT_GROUP, m.CATEGORY, m.SUB_CATEGORY, m.ITEM, m.SUB_ITEM, m.SCRIPT_NAME
			) A
			where 1=1 
			
			<choose>
				<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
					and (
					<if test="filters.rules.size() > 0" >
			       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
			           		<if test="index > 0 "> ${filters.groupOp} </if>   REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
			       		</foreach>	
			       	</if>	
			       	<if test="filters.groups != null and filters.groups.size() > 0">
		       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
			       			<if test="group.rules.size() > 0">
			       			${filters.groupOp}
				           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
					        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
					       	</foreach>
					       	</if>
				       	</foreach>
		       		</if> 
		       		 )
		   		</when>
	   		</choose>
	   		   
	   		
		) A
		where
    	<![CDATA[
	    	A.row_num >  to_number(#{rows}) * (to_number(#{page}) -1) 
	    	and A.row_num <= to_number(#{rows}) * to_number(#{page})
    	]]>	
		
    </select>
    <select id="dashboard.ssd_sm.detail.paging.page" resultType="hashmap">
    	select 
				ceil(count(*)/ #{rows} ) as total,
				#{page} as page ,
				count(*) records 
			from 
			(
				select a.* from (
		    		select 
						f.PROJECT,
						f.FIRMWARE,
						m.SCRIPT_NAME,	
						m.SCRIPT_GROUP,
						m.STAGE, 
						m.CATEGORY, 
						m.SUB_CATEGORY, 
						m.ITEM, 
						m.SUB_ITEM, 
						m.DESCRIPTION, 
						m.TESTER,
						-- r.SCRIPT_NAME,
						to_char(r.START_DT,'YYYY-MM-DD') as START_DT, 
						to_char(r.END_DT,'YYYY-MM-DD') as END_DT, 
						r.STATUS, 
						r.REMARK, 
						r.ASSIGNEE, 
						r.INS_DT, 
						r.MOD_DT
						
					from SSD_SM_FIRMWARE f
					join SSD_SM_SCRIPTSET_MAP sm
						on sm.SCRIPTSET = f.SCRIPTSET
					join SSD_SM_MASTER m
						on m.script_name = sm.script_name
					left outer join SSD_SM_RESULT r
						on r.PROJECT = f.PROJECT
						and r.FIRMWARE = f.FIRMWARE
						and r.SCRIPT_NAME = sm.SCRIPT_NAME
					where 1=1
					and f.firmware = #{search_firmware}
					<if test="countGubun != null and countGubun != '' and countGubun == 'BLANK'  " > and r.STATUS is null</if>
					<if test="countGubun != null and countGubun != '' and countGubun != 'BLANK' and countGubun != 'TOTAL'  " > and r.STATUS =  #{countGubun} </if>
					<if test="scriptGroup != null and scriptGroup != '' " > and m.SCRIPT_GROUP  = #{scriptGroup}</if>
					<if test="stageArr  != null and stageArr != '' ">
					and m.stage in
					<foreach collection="stageArr" item="item" index="index" open="(" separator="," close=")" >#{item}</foreach>
					</if>
					order by m.STAGE, m.SCRIPT_GROUP, m.CATEGORY, m.SUB_CATEGORY, m.ITEM, m.SUB_ITEM, m.SCRIPT_NAME
			) A
			where 1=1 
			
			<choose>
				<when test="filters != null and filters != '' and (filters.rules.size() > 0  or (filters.groups != null and filters.groups.size() > 0) )">
					and (
					<if test="filters.rules.size() > 0" >
			       		<foreach collection="filters.rules" item="item" index="index"  open="(" separator="" close=")">
			           		<if test="index > 0 "> ${filters.groupOp} </if>   REGEXP_LIKE(${item.field}, REGEXP_REPLACE(#{item.data},' ','|'),'i')
			       		</foreach>	
			       	</if>	
			       	<if test="filters.groups != null and filters.groups.size() > 0">
		       			<foreach collection="filters.groups" item="group" index="group_index"  open=""  close="">
			       			<if test="group.rules.size() > 0">
			       			${filters.groupOp}
				           	<foreach collection="group.rules" item="rule" index="rule_index"  open="("   separator="" close=")">
					        	<if test="rule_index > 0 "> ${group.groupOp} </if> REGEXP_LIKE(${rule.field},#{rule.data},'i') 		           		 
					       	</foreach>
					       	</if>
				       	</foreach>
		       		</if> 
		       		 )
		   		</when>
	   		</choose>
	   		   
	   		
		)
		
		
    </select>
    <select id="dashboard.ssd_sm.detail.select.one" resultType="hashmap">
    	select 
			f.PROJECT,
			f.FIRMWARE,
			m.SCRIPT_NAME,	
			m.SCRIPT_GROUP,
			m.STAGE, 
			m.CATEGORY, 
			m.SUB_CATEGORY, 
			m.ITEM, 
			m.SUB_ITEM, 
			m.DESCRIPTION, 
			m.TESTER,
			-- r.SCRIPT_NAME,
			to_char(r.START_DT,'YYYY-MM-DD') as START_DT, 
			to_char(r.END_DT,'YYYY-MM-DD') as END_DT, 
			r.STATUS, 
			r.REMARK, 
			r.ASSIGNEE, 
			r.INS_DT, 
			r.MOD_DT
			
		from SSD_SM_FIRMWARE f
		join SSD_SM_SCRIPTSET_MAP sm
			on sm.SCRIPTSET = f.SCRIPTSET
		join SSD_SM_MASTER m
			on m.script_name = sm.script_name
		left outer join SSD_SM_RESULT r
			on r.PROJECT = f.PROJECT
			and r.FIRMWARE = f.FIRMWARE
			and r.SCRIPT_NAME = sm.SCRIPT_NAME
		where 1=1
		and f.firmware = #{firmware}
		and m.script_name = #{script_name}
    </select>
    <update id="dashbaord.ssd_sm.firmware.status.edit" parameterType="hashmap">
    	declare
	    	cnt number;
	    begin
	    		
	    		select count(*) into cnt from SSD_SM_RESULT
	    		where PROJECT = #{origindata.PROJECT}
	    		and FIRMWARE = #{origindata.FIRMWARE}
                and  SCRIPT_NAME = #{origindata.SCRIPT_NAME} ;
	    			
	    		if cnt = 0 then
	    			insert into SSD_SM_RESULT (PROJECT, FIRMWARE, SCRIPT_NAME, START_DT, END_DT, STATUS, ASSIGNEE, INS_DT)
	    			values (
	    				#{origindata.PROJECT}
	    				, #{origindata.FIRMWARE}
	    				, #{origindata.SCRIPT_NAME}
	    				, to_date(#{START_DT},'YYYY-MM-DD')
	    				,  to_date(#{END_DT},'YYYY-MM-DD')
	    				, #{STATUS}
	    				, ''
	    				, sysdate
	    			);
	    		else
	    		
	                update SSD_SM_RESULT set
	  					MOD_DT = sysdate
	  					<if test="START_DT != origindata.START_DT">,START_DT = to_date(#{START_DT},'YYYY-MM-DD')</if>
	  					<if test="END_DT != origindata.END_DT">,END_DT = to_date(#{END_DT},'YYYY-MM-DD')</if>
	  					<if test="STATUS != null and STATUS != ''  and STATUS != origindata.STATUS">,STATUS = #{STATUS}</if>
	                where PROJECT = #{origindata.PROJECT}
		    		and FIRMWARE = #{origindata.FIRMWARE}
	                and  SCRIPT_NAME = #{origindata.SCRIPT_NAME} ;
	               
	          	end if;
                
       	 
	    end;
    
    </update>
    <update id="dashbaord.ssd_sm.firmware.status.edit.by.react" parameterType="hashmap">
    	declare
	    	cnt number;
	    	v_script_name varchar2(2000);
	    	v_convert_script varchar2(2000);
	    	v_status varchar2(10);
	    begin
	    	
	    		select count(*) into cnt from SSD_SM_RESULT
	    		where 1=1
	    		<choose>
						<when test="searchJson != null and searchJson != '' and searchJson.origindatas.size() > 0 " >
			       		<foreach collection="searchJson.origindatas" item="item" index="index"  >
			       			and ${item.field} = #{item.value}
			       		</foreach>
			   		</when>
			   		<otherwise>
			   			and 1=2
			   		</otherwise>
		   		</choose>   
	    		;
	    		
	    		if cnt = 1 then
	    			update SSD_SM_RESULT set
	              	${fieldName} = #{fieldValue},	  
	              	MOD_DT = sysdate
	              	where 1=1
		    		<choose>
						<when test="searchJson != null and searchJson != '' and searchJson.origindatas.size() > 0 " >
				       		<foreach collection="searchJson.origindatas" item="item" index="index"  >
				       			and ${item.field} = #{item.value}
				       		</foreach>
				   		</when>
				   		<otherwise>
				   			and 1=2
				   		</otherwise>
			   		</choose>          	
	          		;
			    else
			    	insert into    SSD_SM_RESULT (
			    		INS_DT
			    		<if test="searchJson != null and searchJson != '' and searchJson.origindatas.size() > 0 " >
				       		<foreach collection="searchJson.origindatas" item="item" index="index"  >
				       			,${item.field}
				       		</foreach>
				   		</if>
				   		,${fieldName}
			    	)
			    	values (
			    		SYSDATE
			    		<if test="searchJson != null and searchJson != '' and searchJson.origindatas.size() > 0 " >
				       		<foreach collection="searchJson.origindatas" item="item" index="index"  >
				       			,#{item.value}
				       		</foreach>
				   		</if>
				   		,#{fieldValue}
			    	
			    	);
			    	
	        	end if;
                
       	 
	    end;
    </update>
    
    
    <select id="dashboard.ssd_sm.master.all" resultType="hashmap">
    	Select 
			*		
		From 
		(
			select
				A.*, ROWNUM AS ROW_NUM
			from 
			(
		    	SELECT
		    		count(*) over() AS tot_cnt,
		    		<choose>
						<when test="filters != null and filters !='' and filters.copyList.size() > 0 ">
							'I' AS row_status,
						</when>
						<otherwise>
							'' AS row_status,
						</otherwise>
					</choose>
				    aa.item_code,
				    FN_SSD_TEST_GET_COMM_CD(category1,'01',4) as category1,
				    FN_SSD_TEST_GET_COMM_CD(category2,'02',4) as category2,
				    test_name,
				    test_case_id,
				    seq,
				    decode((select max(to_number(rev)) from ssd_test_master b where aa.item_code = b.item_code), rev, rev||'*',rev) as rev,
				    decode((select max(to_number(rev)) from ssd_test_master b where aa.item_code = b.item_code), rev, 'Y','N') as color_check,
				    (select LISTAGG(rev, ',') WITHIN GROUP (ORDER BY rev) from ssd_test_master b where aa.item_code = b.item_code) AS rev_all,
				    FN_SSD_TEST_GET_COMM_CD(test_type,'00',4) as test_type,
				    FN_SSD_TEST_GET_COMM_CD(tool,'03',4) as tool,
				    FN_SSD_TEST_GET_COMM_CD(protocol,'05',4) as protocol,
				    sub_category1,
				    sub_category2,
				    command_line,
				    arg_00,
				    arg_02,
				    arg_03,
				    arg_04,
				    arg_05,
				    arg_06,
				    arg_07,
				    arg_08,
				    arg_09,
				    delete_yn,
				    description,
				    status,
				    to_char(crt_dt,'YYYY-MM-DD') as crt_dt,
				    crt_by,
				    to_char(mod_dt,'YYYY-MM-DD') as mod_dt,
				    mod_by,
				    variation
				FROM
				    ssd_test_master aa,
				(
					SELECT
				        distinct
				        item_code
				        FROM
				            ssd_test_master a
				        <where>
				        	<if test="filters != null and filters !='' and filters.searchTool.size() > 0 ">
								and a.tool in 
								<foreach collection="filters.searchTool" item="type" index="index" open="(" separator="," close=")" >
					       			#{type}
					       		</foreach>
							</if>
							<if test="filters != null and filters !='' and filters.searchProtocol.size() > 0 ">
								and a.protocol in 
								<foreach collection="filters.searchProtocol" item="type" index="index" open="(" separator="," close=")" >
					       			#{type}
					       		</foreach>
							</if>
							<if test="filters != null and filters !='' and filters.searchCate1.size() > 0 ">
								and a.category1 in 
								<foreach collection="filters.searchCate1" item="type" index="index" open="(" separator="," close=")" >
					       			#{type}
					       		</foreach>
							</if>
							<if test="filters != null and filters !='' and filters.searchCate2.size() > 0 ">
								and a.category2 in 
								<foreach collection="filters.searchCate2" item="type" index="index" open="(" separator="," close=")" >
					       			#{type}
					       		</foreach>
							</if>
					        <if test="filters != null and filters !='' and filters.copyList.size() > 0 ">
								and a.item_code in 
								<foreach collection="filters.copyList" item="type" index="index" open="(" separator="," close=")" >
					       			#{type}
					       		</foreach>
							</if>
						</where>
				) bb
				where aa.item_code = bb.item_code
				<choose>
					<when test='listType eq "history" '>
						
					</when>
					<otherwise>
						
						and rev = (select max( to_number( cc.rev ) ) from ssd_test_master cc where aa.item_code = cc.item_code )
						
					</otherwise>
				</choose>
				ORDER BY aa.item_code ASC, to_number(aa.rev) desc
			) A
		)A
		where
	   	<![CDATA[
	    	A.row_num >  to_number(#{rows}) * (to_number(#{page}) -1) 
	    	and A.row_num <= to_number(#{rows}) * to_number(#{page})
	   	]]>				    
    </select>

    <select id="dashboard.ssd_sm.commonComboSearch" resultType="hashmap">
    	SELECT
    			A.COMM_SYMBOL,
    			B.COMM_IDX,
    			A.COMM_TYPE,
    			A.COMM_VALUE
		FROM
		    SSD_TEST_COMM_CD A,
		    SSD_TEST_COMM_CD_MAP B
		WHERE 
			A.COMM_CODE = B.COMM_CODE
		<if test="filters != null and filters !='' and filters.commCdType.size() > 0 ">
			and A.COMM_TYPE in 
			<foreach collection="filters.commCdType" item="item" index="i" open="(" separator="," close=")" >
       			#{item}
       		</foreach>
		</if>
		<if test="testSetSearch != null and testSetSearch !='' ">
			union all
			select 
			    model_name,
			    '',
			    '20',
			    model_name
			from SSD_TEST_SET
			group by model_name
			union all
			select 
			    FN_SSD_TEST_GET_COMM_CD(test_type,'00',4),
			    '',
			    '21',
			    FN_SSD_TEST_GET_COMM_CD(test_type,'00',4)
			from SSD_TEST_SET
			group by test_type
			union all
			select 
			    test_set,
			    '',
			    '22',
			    test_set
			from SSD_TEST_SET
			group by test_set
		</if>
    </select>
    
    <select id="dashboard.ssd_sm.commonCodeSearch" resultType="hashmap">
    	SELECT
    			DISTINCT
    			A.COMM_TYPE,
    			A.COMM_TYPE_VALUE
		FROM
		    SSD_TEST_COMM_CD A,
		    SSD_TEST_COMM_CD_MAP B
		WHERE 
			A.COMM_CODE = B.COMM_CODE
		ORDER BY COMM_TYPE ASC
    </select>
    
    <select id="dashboard.ssd_sm.commonCodeList" resultType="hashmap">
    	SELECT
    			'' AS ROW_STATUS,
    			A.COMM_SYMBOL,
    			A.COMM_CODE,
    			B.COMM_IDX,
    			A.COMM_TYPE,
    			A.COMM_VALUE
		FROM
		    SSD_TEST_COMM_CD A,
		    SSD_TEST_COMM_CD_MAP B
		WHERE 
			A.COMM_CODE = B.COMM_CODE
		<if test="filters != null and filters !='' and filters.searchCode.size() > 0 ">
			and A.COMM_TYPE in 
			<foreach collection="filters.searchCode" item="type" index="index" open="(" separator="," close=")" >
       			#{type}
       		</foreach>
		</if>
		ORDER BY to_number(A.COMM_CODE) ASC
    </select>
    
    <select id="dashboard.ssd_sm.testSetComboSearch" resultType="hashmap">
    	SELECT
    			DISTINCT
    			A.COMM_TYPE,
    			A.COMM_TYPE_VALUE
		FROM
		    SSD_TEST_COMM_CD A,
		    SSD_TEST_COMM_CD_MAP B
		WHERE 
			A.COMM_CODE = B.COMM_CODE
		ORDER BY COMM_TYPE ASC
    </select>
    

    <insert id="dashboard.ssd_sm.commCdGridSave" parameterType="hashmap" >
    	<selectKey  keyProperty="newCommCode" resultType="String" order="BEFORE">
    		select max(to_number(COMM_CODE))+1 from SSD_TEST_COMM_CD
    	</selectKey>
    	declare
	    	cnt number;
	    begin
	    		select count(*) into cnt from SSD_TEST_COMM_CD
	    		where 1=1
	    		<choose>
					<when test="detail != null and detail != '' and detail.size() > 0 " >
			       			and COMM_CODE = #{detail.commCode}
			   		</when>
			   		<otherwise>
			   			and 1=2
			   		</otherwise>
		   		</choose>
	    		;
	    		
	    		if cnt = 1 then
	              	update SSD_TEST_COMM_CD set
	              	COMM_VALUE = #{detail.commValue},
	              	COMM_SYMBOL = #{detail.commSymbol},	  
	              	MOD_DT = SYSDATE,
	              	<choose>
						<when test='detail.mod_by != null and detail.mod_by != ""  '>
							MOD_BY = #{detail.mod_by}
						</when>
						<otherwise>
							MOD_BY = 	'SYSTEM'
						</otherwise>
					</choose>
	              	where 1=1
		    		<choose>
						<when test="detail != null and detail != '' and detail.size() > 0 " >
				       			and COMM_CODE = #{detail.commCode}
				   		</when>
				   		<otherwise>
				   			and 1=2
				   		</otherwise>
			   		</choose>
			   		;
	          	else
	          		insert into SSD_TEST_COMM_CD
	          		(
		          		COMM_CODE,
					    COMM_TYPE,
					    COMM_VALUE,
					    COMM_SYMBOL,
					    COMM_TYPE_VALUE,
					    DESCRIPTION,
					    CRT_BY,
					    MOD_DT,
					    MOD_BY,
					    CRT_DT
				    )values(
				    	#{newCommCode},
				    	#{detail.commType},
				    	#{detail.commValue},
				    	#{detail.commSymbol},
				    	(select DECODE(#{detail.commType}, '00', 'TEST_TYPE',
				    														'01', 'CATEGORY1',
				    														'02', 'CATEGORY2',
				    														'03', 'TOOL',
				    														'04', 'AUTOMATON',
				    														'05', 'PROTOCOL',
				    														'') from dual), 
				    	'',
				    	<choose>
							<when test='detail.crt_by != null and detail.crt_by != ""  '>
								#{detail.crt_by},
							</when>
							<otherwise>
								'SYSTEM',
							</otherwise>
						</choose>
				    	<choose>
							<when test='detail.crt_dt != null and detail.crt_dt != ""  '>
								TO_DATE(SYSDATE, 'YYYY-MM-DD'),
							</when>
							<otherwise>
								SYSDATE,
							</otherwise>
						</choose>
						<choose>
							<when test='detail.mod_by != null and detail.mod_by != ""  '>
								#{detail.mod_by},
							</when>
							<otherwise>
								'SYSTEM',
							</otherwise>
						</choose>
						<choose>
							<when test='detail.mod_dt != null and detail.mod_dt != ""  '>
								TO_DATE(#{detail.mod_dt}, 'YYYY-MM-DD')
							</when>
							<otherwise>
								SYSDATE
							</otherwise>
						</choose>
				    	) ;
				    	
				    	insert into SSD_TEST_COMM_CD_MAP
				    	(
				    		COMM_IDX,
						    COMM_CODE,
						    COMM_TYPE
				    	)values(
				    		(select max(to_number(COMM_IDX))+1 from SSD_TEST_COMM_CD_MAP),
				    		#{newCommCode},
				    		#{detail.commType}
				    	);
	        end if;
	    end;
    </insert>
    
    <!-- Master Mgmt. 일괄 저장 -->
    <insert id="dashboard.ssd_sm.masterGridSave" parameterType="hashmap" >
    		insert into SSD_TEST_MASTER
                (
	                item_code,
				    category1,
				    category2,
				    test_name,
				    rev,
				    tool,
				    protocol,
				    sub_category1,
				    sub_category2,
				    command_line,
				    arg_00,
				    arg_01,
				    arg_02,
				    arg_03,
				    arg_04,
				    arg_05,
				    arg_06,
				    arg_07,
				    arg_08,
				    arg_09,
				    delete_yn,
				    description,
				    status,
				    crt_dt,
				    crt_by,
				    mod_dt,
				    mod_by,
				    variation,
				    test_type
                )values(
                   	<choose>
						<when test='detail.status == "U" '>
							#{detail.item_code},
						</when>
						<otherwise>
							(select lpad(max(ITEM_CODE)+1,16,'0') from SSD_TEST_MASTER),
						</otherwise>
					</choose>
					(select FN_SSD_TEST_GET_COMM_CD(#{detail.category1},'01',2) from dual),
					(select FN_SSD_TEST_GET_COMM_CD(#{detail.category2},'02',2) from dual),
					#{detail.test_name},
					<choose>
						<when test='detail.status == "U" '>
							(select max( to_number(rev) )+1 from SSD_TEST_MASTER where ITEM_CODE = #{detail.item_code}),
						</when>
						<otherwise>
							'1',
						</otherwise>
					</choose>
					(select FN_SSD_TEST_GET_COMM_CD(#{detail.tool},'03',2) from dual),
					(select FN_SSD_TEST_GET_COMM_CD(#{detail.protocol},'05',2)  from dual),
					#{detail.sub_category1},
					#{detail.sub_category2},
					#{detail.command_line},
					#{detail.arg00},
					#{detail.arg01},
					#{detail.arg02},
					#{detail.arg03},
					#{detail.arg04},
					#{detail.arg05},
					#{detail.arg06},
					#{detail.arg07},
					#{detail.arg08},
					#{detail.arg09},
					<choose>
						<when test='detail.delete_yn != null and detail.delete_yn != ""  '>
							#{detail.delete_yn},
						</when>
						<otherwise>
							'N',
						</otherwise>
					</choose>
					'',
					'',
					<choose>
						<when test='detail.crt_dt != null and detail.crt_dt != ""  '>
							TO_DATE(#{detail.crt_dt}, 'YYYY-MM-DD'),
						</when>
						<otherwise>
							SYSDATE,
						</otherwise>
					</choose>
					<choose>
						<when test='detail.crt_by != null and detail.crt_by != ""  '>
							#{detail.crt_by},
						</when>
						<otherwise>
							'SYSTEM',
						</otherwise>
					</choose>
					SYSDATE,
					<choose>
						<when test='detail.mod_by != null and detail.mod_by != ""  '>
							#{detail.mod_by},
						</when>
						<otherwise>
							'SYSTEM',
						</otherwise>
					</choose>
					<choose>
						<when test='detail.variation != null and detail.variation != ""  '>
							#{detail.variation},
						</when>
						<otherwise>
							'public',
						</otherwise>
					</choose>
					FN_SSD_TEST_GET_COMM_CD(#{detail.test_type},'00',2)
            	)
    </insert>
    
    <!-- Test Set List 호출 -->
    <select id="dashboard.ssd_sm.testSet.all" resultType="hashmap">
    	Select 
			*		
		From 
		(
			select
				A.*, ROWNUM AS ROW_NUM
			from 
			(
		    	SELECT
		    		count(*) over() AS tot_cnt
		    		,'' AS row_status
		    		,test_set_idx
				    ,model_name
				    ,FN_SSD_TEST_GET_COMM_CD(test_type,'00',4) AS test_type
				    ,set_default
				    ,test_set
				    ,(select count(*) from ssd_test_set_dtl b where b.test_set_idx = a.test_set_idx) AS total_test_count
				    ,status
				    ,owner
				    ,to_char(crt_dt, 'YYYY-MM-DD') as crt_dt
				    ,crt_by
				    ,to_char(mod_dt, 'YYYY-MM-DD') as mod_dt
				    ,mod_by
				FROM
				    ssd_test_set a
				<where>
					<if test="filters != null and filters !='' and filters.searchModelName.size() > 0 ">
						and a.model_name in 
						<foreach collection="filters.searchModelName" item="type" index="index" open="(" separator="," close=")" >
			       			#{type}
			       		</foreach>
					</if>
					<if test="filters != null and filters !='' and filters.searchTestType.size() > 0 ">
						and a.test_type in 
						<foreach collection="filters.searchTestType" item="type" index="index" open="(" separator="," close=")" >
			       			FN_SSD_TEST_GET_COMM_CD(#{type}, '00', 2)
			       		</foreach>
					</if>
					<if test="filters != null and filters !='' and filters.searchTestSet.size() > 0 ">
						and a.test_set in 
						<foreach collection="filters.searchTestSet" item="type" index="index" open="(" separator="," close=")" >
			       			#{type}
			       		</foreach>
					</if>
				</where>
				ORDER BY crt_dt DESC, mod_dt DESC
			) A
		) A
		where
    	<![CDATA[
	    	A.row_num >  to_number(#{rows}) * (to_number(#{page}) -1) 
	    	and A.row_num <= to_number(#{rows}) * to_number(#{page})
    	]]>				    
    </select>
    
    <!-- Test Set 일괄 저장 -->
    <insert id="dashboard.ssd_sm.testSetGridSave" parameterType="hashmap" >
    		merge into SSD_TEST_SET T 
    		USING DUAL
    			ON (T.TEST_SET_IDX = #{detail.testSetIdx}
    					AND T.MODEL_NAME = #{detail.modelName}
    					AND T.TEST_TYPE = FN_SSD_TEST_GET_COMM_CD(#{detail.testType}, '00', 2)
    					AND T.TEST_SET = #{detail.testSet}
    			)
    		WHEN MATCHED THEN
    			update set
   						SET_DEFAULT = #{detail.setDefault}
   						,STATUS = 'Released'
   						,MOD_DT = SYSDATE
						<choose>
							<when test='detail.mod_by != null and detail.mod_by != ""  '>
								, MOD_BY = #{detail.mod_by}
							</when>
							<otherwise>
								, MOD_BY = 'ADMIN'
							</otherwise>
						</choose>
    				
    		WHEN NOT MATCHED THEN
    			insert
    			(
    				test_set_idx,
				    model_name,
				    test_type,
				    test_set,
				    set_default,
				    status,
				    owner,
				    crt_dt,
				    crt_by,
				    mod_dt,
				    mod_by
                )values(
                   	(select nvl(max(TEST_SET_IDX), 0)+1 from SSD_TEST_SET),
                   	#{detail.modelName},
					(select FN_SSD_TEST_GET_COMM_CD(#{detail.testType},'00',2) from dual),
					#{detail.testSet},
					<choose>
						<when test='detail.setDefault != null and detail.setDefault != ""  '>
							#{detail.setDefault},
						</when>
						<otherwise>
							'N',
						</otherwise>
					</choose>
					<choose>
						<when test='detail.status != null and detail.status != ""  '>
							#{detail.status},
						</when>
						<otherwise>
							'Released',
						</otherwise>
					</choose>
					<choose>
						<when test='detail.owner != null and detail.owner != ""  '>
							#{detail.owner},
						</when>
						<otherwise>
							'',
						</otherwise>
					</choose>
					<choose>
						<when test='detail.crt_dt != null and detail.crt_dt != ""  '>
							TO_DATE(#{detail.crt_dt}, 'YYYY-MM-DD'),
						</when>
						<otherwise>
							SYSDATE,
						</otherwise>
					</choose>
					<choose>
						<when test='detail.crt_by != null and detail.crt_by != ""  '>
							#{detail.crt_by},
						</when>
						<otherwise>
							'ADMIN',
						</otherwise>
					</choose>
					<choose>
						<when test='detail.mod_dt != null and detail.mod_dt != ""  '>
							TO_DATE(#{detail.mod_dt}, 'YYYY-MM-DD'),
						</when>
						<otherwise>
							SYSDATE,
						</otherwise>
					</choose>
					<choose>
						<when test='detail.mod_by != null and detail.mod_by != ""  '>
							#{detail.mod_by}
						</when>
						<otherwise>
							'ADMIN'
						</otherwise>
					</choose>
            	)
    </insert>
    
    
    <select id="dashboard.ssd_sm.testSet.dtl" resultType="hashmap">
    	Select 
			*		
		From 
		(
			select
				A.*, ROWNUM AS ROW_NUM
			from 
			(
		    	SELECT
		    		count(*) over() AS tot_cnt,
		    		<choose>
						<when test="filters != null and filters !='' and filters.copyList.size() > 0 ">
							'I' AS row_status,
						</when>
						<otherwise>
							'' AS row_status,
						</otherwise>
					</choose>
		    		item_code,
				    FN_SSD_TEST_GET_COMM_CD(category1, '01', 4) AS category1,
				    FN_SSD_TEST_GET_COMM_CD(category2, '02', 4) AS category2,
				    test_name,
				    test_case_id||'-'||lpad(seq, 3, '0') AS test_case_id,
				    test_case_id AS test_case_id_org,
				    seq,
				    <choose>
						<when test="filters != null and filters !='' and filters.copyList.size() > 0 ">
							'' AS max_seq,
						</when>
						<otherwise>
							(select max(to_number(seq)) from ssd_test_set_dtl D where D.test_case_id = A.test_case_id and D.TEST_SET_IDX = #{testSetIdx}) AS max_seq,
						</otherwise>
					</choose>
				    decode((select max(to_number(rev)) from ssd_test_master b where a.item_code = b.item_code), rev, rev||'*',rev) as rev,
				    (select LISTAGG(rev, ',') WITHIN GROUP (ORDER BY rev) from ssd_test_master b where A.item_code = b.item_code) AS rev_all,
				    FN_SSD_TEST_GET_COMM_CD(test_type, '00', 4) AS test_type,
				    FN_SSD_TEST_GET_COMM_CD(tool, '03', 4) AS tool,
				    FN_SSD_TEST_GET_COMM_CD(protocol, '05', 4) AS protocol,
				    sub_category1,
				    sub_category2,
				    command_line,
				    arg_00,
				    arg_01,
				    arg_02,
				    arg_03,
				    arg_04,
				    arg_05,
				    arg_06,
				    arg_07,
				    arg_08,
				    arg_09,
				    delete_yn,
				    description,
				    status,
				    to_char(crt_dt,'YYYY-MM-DD') as crt_dt,
				    crt_by,
				    to_char(mod_dt,'YYYY-MM-DD') as mod_dt,
				    mod_by,
				    variation,
				    test_set_idx
				FROM
				    ssd_test_set_dtl A
				<where>
					<if test="testSetIdx != null and testSetIdx !='' ">
						A.TEST_SET_IDX = #{testSetIdx} 
					</if>
					<if test="filters != null and filters !='' and filters.copyList.size() > 0 ">
						and a.test_set_idx in 
						<foreach collection="filters.copyList" item="type" index="index" open="(" separator="," close=")" >
			       			#{type}
			       		</foreach>
					</if>
				</where>
			) A
			ORDER BY test_case_id_org ASC, to_number(seq) ASC, item_code asc
		) A
		where
    	<![CDATA[
	    	A.row_num >  to_number(#{rows}) * (to_number(#{page}) -1) 
	    	and A.row_num <= to_number(#{rows}) * to_number(#{page})
    	]]>				    
    </select>
    
    <!-- Test Set Pop 에서 public 일때 해당 master의 revision 의 리스트를 선택할수 있는 목록 -->
    <select id="dashboard.ssd_sm.testSet.revList" resultType="hashmap">
    	select 
    		AA.rev
    	from
    		(
	    	select 
	    		to_number(B.rev) as rev
	    	from ssd_test_set_dtl A,
	    			ssd_test_master B
	    	where A.item_code = B.item_code
			<if test="testSetIdx != null and testSetIdx !='' ">
				AND A.TEST_SET_IDX = #{testSetIdx} 
			</if>
			<if test="itemCode != null and itemCode !='' ">
				AND B.ITEM_CODE = #{itemCode} 
			</if>
			) AA
			ORDER BY to_number(rev) ASC
    </select>
    
    <!-- Test Set Pop 에서 public 일때 해당 master의 revision 선택, 세부내용 -->
    <select id="dashboard.ssd_sm.testSet.revDtl" resultType="hashmap">
	  		select 
	    				item_code,
					    FN_SSD_TEST_GET_COMM_CD(category1, '01', 4) AS category1,
					    FN_SSD_TEST_GET_COMM_CD(category2, '02', 4) AS category2,
					    test_name,
					    decode((select max(to_number(rev)) from ssd_test_master b where a.item_code = b.item_code), rev, rev||'*',rev) as rev,
					    FN_SSD_TEST_GET_COMM_CD(test_type, '00', 4) AS test_type,
					    FN_SSD_TEST_GET_COMM_CD(tool, '03', 4) AS tool,
					    FN_SSD_TEST_GET_COMM_CD(protocol, '05', 4) AS protocol,
					    sub_category1,
					    sub_category2,
					    command_line,
					    arg_00,
					    arg_01,
					    arg_02,
					    arg_03,
					    arg_04,
					    arg_05,
					    arg_06,
					    arg_07,
					    arg_08,
					    arg_09,
					    delete_yn,
					    description,
					    status,
					    to_char(crt_dt,'YYYY-MM-DD') as crt_dt,
					    crt_by,
					    to_char(mod_dt,'YYYY-MM-DD') as mod_dt,
					    mod_by,
					    variation
			from SSD_TEST_MASTER A
			<where>
				<if test="itemCode != null and itemCode !='' ">
					AND A.ITEM_CODE = #{itemCode} 
				</if>
				<if test="rev != null and rev !='' ">
					AND A.REV = #{rev}
				</if>
			</where>
    </select>
    
    
    
    <!-- test Set 의 상태를 update  -->
    <update id="dashboard.ssd_sm.testSet.statusUpdate" parameterType="hashmap" >
    	update SSD_TEST_SET set
    		status = #{status},
    		owner = #{loginUserId},
    		mod_by = #{loginUserId},
    		mod_dt = SYSDATE
    	where TEST_SET_IDX = #{testSetIdx}
    </update>
    
    <!-- TestSet Copy에서 자신 이외의 TestSet List -->
    <select id="dashboard.ssd_sm.testSet.others" resultType="hashmap">
    	Select 
			*		
		From 
		(
			select
				A.*, ROWNUM AS ROW_NUM
			from 
			(
		    	SELECT
		    		count(*) over() AS tot_cnt,
		    		'' AS row_status,
		    		test_set_idx,
				    model_name,
				    FN_SSD_TEST_GET_COMM_CD(test_type,'00',4) AS test_type,
				    set_default,
				    test_set,
				    (select count(*) from ssd_test_set_dtl b where b.test_set_idx = a.test_set_idx) AS total_test_count,
				    status,
				    owner,
				    to_char(crt_dt,'YYYY-MM-DD') as crt_dt,
				    crt_by,
				    to_char(mod_dt,'YYYY-MM-DD') as mod_dt,
				    mod_by
				FROM
				    ssd_test_set a
				<where>
					<if test="testSetIdx != null and testSetIdx !='' ">
						A.TEST_SET_IDX != #{testSetIdx} 
					</if>
				</where>
				<![CDATA[ 
				AND 0 < (SELECT COUNT(*) FROM ssd_test_set_dtl b
				]]>
							 where a.test_set_idx = b.test_set_idx 
							)
				
				ORDER BY crt_dt DESC, mod_dt DESC
			) A
		) A
		where
    	<![CDATA[
	    	A.row_num >  to_number(#{rows}) * (to_number(#{page}) -1) 
	    	and A.row_num <= to_number(#{rows}) * to_number(#{page})
    	]]>				    
    </select>
    
    <!-- Test Set Dtl 일괄 저장시 먼저 해당 Test Set 들 모두 삭제 -->
    <delete id="dashboard.ssd_sm.testSetDtlGridSave.beforeDel">
    	DELETE FROM SSD_TEST_SET_DTL
    	WHERE TEST_SET_IDX = #{detail.testSetIdx}
    </delete>
    
    <!-- Test Set Dtl 일괄 저장 -->
    <insert id="dashboard.ssd_sm.testSetDtlGridSave" parameterType="hashmap" >
		<selectKey  keyProperty="new_item_code" resultType="String" order="BEFORE">
    		select distinct 'P'||lpad(to_number(#{detail.testSetIdx}), 5, '0')||
    				decode((select lpad(max(substr(ITEM_CODE, 7))+1, 10,'0') from SSD_TEST_SET_DTL where TEST_SET_IDX = #{detail.testSetIdx}),'','0000000001',
    				(select lpad(max(substr(ITEM_CODE, 7))+1, 10,'0') from SSD_TEST_SET_DTL where TEST_SET_IDX = #{detail.testSetIdx})) AS new_item_code
    		from dual
    	</selectKey>
    	
    		merge into SSD_TEST_SET_DTL T 
    		USING DUAL
    			ON (T.ITEM_CODE = #{detail.item_code}
    					AND T.TEST_SET_IDX = #{detail.testSetIdx}
    			)
    		WHEN MATCHED THEN
    			update set
   						category1 = FN_SSD_TEST_GET_COMM_CD(#{detail.category1},'01', 2),
						category2 = FN_SSD_TEST_GET_COMM_CD(#{detail.category2},'02', 2),
						test_name = #{detail.test_name},
						test_case_id = #{detail.test_case_id},
						<!-- seq = (select decode((select max(nvl(seq, 0))+1 from SSD_TEST_SET_DTL D where D.TEST_SET_IDX = #{detail.testSetIdx} AND D.TEST_CASE_ID = #{detail.test_case_id}), '', 1, 
                                (select max(nvl(seq, 0))+1 from SSD_TEST_SET_DTL D where D.TEST_SET_IDX = #{detail.testSetIdx} AND D.TEST_CASE_ID = #{detail.test_case_id})) as tt from dual),		 -->
                        seq = #{detail.seq},
						rev = replace(#{detail.rev}, '*', ''),
						test_type = FN_SSD_TEST_GET_COMM_CD(#{detail.test_type},'00', 2),
						tool = FN_SSD_TEST_GET_COMM_CD(#{detail.tool},'03', 2),
						protocol = FN_SSD_TEST_GET_COMM_CD(#{detail.protocol},'05', 2),
						sub_category1 = #{detail.sub_category1},
						sub_category2 = #{detail.sub_category2},
						command_line = #{detail.command_line},
						arg_00 = #{detail.arg00},
						arg_01 = #{detail.arg01},
						arg_02 = #{detail.arg02},
						arg_03 = #{detail.arg03},
						arg_04 = #{detail.arg04},
						arg_05 = #{detail.arg05},
						arg_06 = #{detail.arg06},
						arg_07 = #{detail.arg07},
						arg_08 = #{detail.arg08},
						arg_09 = #{detail.arg09},
						<choose>
						<when test='detail.delete_yn != null and detail.delete_yn != ""  '>
							delete_yn = #{detail.delete_yn},
						</when>
						<otherwise>
							delete_yn = 'N',
						</otherwise>
					</choose>
						variation = #{detail.variation},
   						mod_dt = SYSDATE
						<choose>
							<when test='detail.mod_by != null and detail.mod_by != ""  '>
								, MOD_BY = #{detail.mod_by}
							</when>
							<otherwise>
								, MOD_BY = 'SYSTEM'
							</otherwise>
						</choose>
    				
    		WHEN NOT MATCHED THEN
    			insert
    			(
    				item_code,
				    category1,
				    category2,
				    test_name,
				    test_case_id,
				    seq,
				    rev,
				    test_type,
				    tool,
				    protocol,
				    sub_category1,
				    sub_category2,
				    command_line,
				    arg_00,
				    arg_01,
				    arg_02,
				    arg_03,
				    arg_04,
				    arg_05,
				    arg_06,
				    arg_07,
				    arg_08,
				    arg_09,
				    delete_yn,
				    description,
				    status,
				    crt_dt,
				    crt_by,
				    mod_dt,
				    mod_by,
				    variation,
				    test_set_idx
                )values(
                	<choose>
						<when test='detail.item_code != null and detail.item_code != ""  '>
							#{detail.item_code},
						</when>
						<otherwise>
							#{new_item_code},
						</otherwise>
					</choose>	
					FN_SSD_TEST_GET_COMM_CD(#{detail.category1},'01', 2),
					FN_SSD_TEST_GET_COMM_CD(#{detail.category2},'02', 2),
					#{detail.test_name},
					#{detail.test_case_id},
					(select decode((select max(nvl(to_number(seq), 0))+1 from SSD_TEST_SET_DTL D where D.TEST_SET_IDX = #{detail.testSetIdx} AND D.TEST_CASE_ID = #{detail.test_case_id}), '', 1, 
                                (select max(nvl(to_number(seq), 0))+1 from SSD_TEST_SET_DTL D where D.TEST_SET_IDX = #{detail.testSetIdx} AND D.TEST_CASE_ID = #{detail.test_case_id})) as tt from dual),
					replace(#{detail.rev}, '*', ''),
					FN_SSD_TEST_GET_COMM_CD(#{detail.test_type},'00', 2),
					FN_SSD_TEST_GET_COMM_CD(#{detail.tool},'03', 2),
					FN_SSD_TEST_GET_COMM_CD(#{detail.protocol},'05', 2),
					#{detail.sub_category1},
					#{detail.sub_category2},
					#{detail.command_line},
					#{detail.arg00},
					#{detail.arg01},
					#{detail.arg02},
					#{detail.arg03},
					#{detail.arg04},
					#{detail.arg05},
					#{detail.arg06},
					#{detail.arg07},
					#{detail.arg08},
					#{detail.arg09},
					<choose>
						<when test='detail.delete_yn != null and detail.delete_yn != ""  '>
							#{detail.delete_yn},
						</when>
						<otherwise>
							'N',
						</otherwise>
					</choose>
					'',
					'',
					<choose>
						<when test='detail.crt_dt != null and detail.crt_dt != ""  '>
							TO_DATE(#{detail.crt_dt}, 'YYYY-MM-DD'),
						</when>
						<otherwise>
							SYSDATE,
						</otherwise>
					</choose>
					<choose>
						<when test='detail.crt_by != null and detail.crt_by != ""  '>
							#{detail.crt_by},
						</when>
						<otherwise>
							'SYSTEM',
						</otherwise>
					</choose>
					<choose>
						<when test='detail.mod_dt != null and detail.mod_dt != ""  '>
							TO_DATE(#{detail.mod_dt}, 'YYYY-MM-DD'),
						</when>
						<otherwise>
							SYSDATE,
						</otherwise>
					</choose>
					<choose>
						<when test='detail.mod_by != null and detail.mod_by != ""  '>
							#{detail.mod_by},
						</when>
						<otherwise>
							'SYSTEM',
						</otherwise>
					</choose>
					#{detail.variation},
					#{detail.testSetIdx}
            	)
    </insert>
    
    <!-- Test Map Project List 호출 -->
    <select id="dashboard.ssd_sm.mapProject.all" resultType="hashmap">
    	Select 
			*		
		From 
		(
			select
				A.*, ROWNUM AS ROW_NUM
			from 
			(
		    	SELECT
			    		count(*) over() AS tot_cnt
			    		,'' AS row_status
			    		,b.id AS project_id
				        ,b.pjt_code
				        ,b.project_name AS project_name
				        ,FN_SSD_TEST_GET_COMM_CD(a.test_type,'00',4) AS test_type
				        ,(select c.test_set from ssd_test_set c where c.test_set_idx = a.test_set) AS test_set
				        ,to_char(a.crt_dt, 'YYYY-MM-DD') as crt_dt
				        ,a.crt_by
				        ,to_char(a.mod_dt, 'YYYY-MM-DD') as mod_dt
				        ,mod_by
				from SSD_TEST_MAP_PROJECT a,
				    REGRESSION_STAT_META b
				where a.project_id(+) = b.id
				ORDER BY b.id ASC, mod_dt DESC
			) A
		) A
		where
    	<![CDATA[
	    	A.row_num >  to_number(#{rows}) * (to_number(#{page}) -1) 
	    	and A.row_num <= to_number(#{rows}) * to_number(#{page})
    	]]>				    
    </select>
    
    <insert id="dashboard.ssd_sm.mapProjectGridSave" parameterType="hashmap">
    	merge into SSD_TEST_MAP_PROJECT T 
    		USING DUAL
    			ON (
    					T.PROJECT_ID = #{detail.projectId}
    			)
    		WHEN MATCHED THEN
    			update set
    					TEST_TYPE = FN_SSD_TEST_GET_COMM_CD(#{detail.testType},'00', 2)
    					, TEST_SET = (select test_set_idx from ssd_test_set where test_set = #{detail.testSet})
    					, MOD_DT = SYSDATE
						<choose>
							<when test='detail.modBy != null and detail.modBy != ""  '>
								, MOD_BY = #{detail.modBy}
							</when>
							<otherwise>
								, MOD_BY = 'SYSTEM'
							</otherwise>
						</choose>
			WHEN NOT MATCHED THEN
    			insert
    			(
    				project_id,
				    test_type,
				    test_set,
				    crt_by,
				    crt_dt,
				    mod_by,
				    mod_dt
    			)values(
    				#{detail.projectId}
    				,FN_SSD_TEST_GET_COMM_CD(#{detail.testType},'00', 2)
    				,(select test_set_idx from ssd_test_set where test_set = #{detail.testSet})
					<choose>
						<when test='detail.crtBy != null and detail.crtBy != ""  '>
							,#{detail.crtBy}
						</when>
						<otherwise>
							,'SYSTEM'
						</otherwise>
					</choose>
					,SYSDATE
					<choose>
						<when test='detail.modBy != null and detail.modBy != ""  '>
							,#{detail.modBy}
						</when>
						<otherwise>
							,'SYSTEM'
						</otherwise>
					</choose>
					,SYSDATE
    			)
    </insert>
    <select id="dashboard.ssd_test.summary.all" resultType="hashmap">
		with tbl_list as (
   			select 
				sum(count(sm.item_code)) over() tot, 
				project.id as project ,			
				count(sm.item_code) project_tot,
				(
					select count(*) cnt 
					from regression_stat_meta_detail rt				
	        		where rt.meta_id = project.id
					and rt.status is null				
				) as "N/A", 
	      		(
					select count(*) cnt 
					from regression_stat_meta_detail rt				
	        		where rt.meta_id = project.id
					and rt.status = 'Stopped'	
				) as Stopped ,
				(
					select count(*) cnt 
					from regression_stat_meta_detail rt				
	        		where rt.meta_id = project.id
					and rt.status = 'Abort'	
				) as Abort,
				(
					select count(*) cnt 
					from regression_stat_meta_detail rt				
	        		where rt.meta_id = project.id
					and rt.status = 'Fail'	
				) as Fail,
				(
					select count(*) cnt 
					from regression_stat_meta_detail rt				
	        		where rt.meta_id = project.id
					and rt.status = 'Breakdown'	
				) as Breakdown,
				(
					select count(*) cnt 
					from regression_stat_meta_detail rt				
	        		where rt.meta_id = project.id
					and rt.status = 'Running'	
				) as Running ,
				(
					select count(*) cnt 
					from regression_stat_meta_detail rt				
	        		where rt.meta_id = project.id
					and rt.status = 'Success'	
				) as Success ,
				(
					select count(*) cnt 
					from regression_stat_meta_detail rt				
	        		where rt.meta_id = project.id
					and rt.status = 'Skipped'	
				) as Skipped
			
			from regression_stat_meta_detail r 
			left outer join regression_stat_meta project
				on r.meta_id = project.id		
			left outer join ssd_test_map_project psm
				on psm.project_id = project.id
			left outer join ssd_test_set ts
				on ts.TEST_SET_IDX = psm.TEST_SET			
			left outer join SSD_TEST_SET_DTL sm
				on sm.TEST_SET_IDX = ts.TEST_SET_IDX
				and r.item_code = sm.item_code
			left outer join (select distinct item_code  from ssd_test_master )  m
				on m.item_code = sm.item_code			 
			where  1=1
			and project.id is not null
			--and project.ID in ('PJT_00064243_xxxxx.20180529_119','PJT_00064243_xxxxx.20180529_123')
			group by project.id
		) 

		select
			   COUNT(*) OVER() AS tot_cnt
			, f.PJT_CODE 
			, a.project
			, f.PROJECT_NAME
			, psm.TEST_SET 
			, f.GENERATED
			, f.STARTED
			, f.FINISHED
			, FW_MATURITY
			, PROJECT_TYPE
			, CATEGORY
			, PRODUCT
			, NAND_TECH
			, NAND_REVISION
			, CONTROLLER_REVISION
			, FORM_FACTOR
			, DENSITY
			, CUSTOMER
			, DEPOT
			, FW_REVISION
			, FW_BINARY
			, LINK
			, DESCRIPTION
			
			
			
			, a.project_tot		
			, a.Success
			, case a.project_tot when 0 then 0 else a.Success/a.project_tot end as Success_RATIO	
			, a.Fail
			, case a.project_tot when 0 then 0 else a.Fail/a.project_tot end as Fail_RATIO
			, a."N/A" as NA
			, case a.project_tot when 0 then 0 else a."N/A"/a.project_tot end as NA_RATIO
			, a.Stopped
			, case a.project_tot when 0 then 0 else a.Stopped/a.project_tot end as Stopped_RATIO
			, a.Abort
			, case a.project_tot when 0 then 0 else a.Abort/a.project_tot end as Abort_RATIO			
			, a.Breakdown
			, case a.project_tot when 0 then 0 else a.Breakdown/a.project_tot end as Breakdown_RATIO
			, a.Running
			, case a.project_tot when 0 then 0 else a.Running/a.project_tot end as Running_RATIO
			
			, a.Skipped
			, case a.project_tot when 0 then 0 else a.Skipped/a.project_tot end as Skipped_RATIO
			
		from tbl_list a
		left outer join REGRESSION_STAT_META f
			on f.id = a.project
		left outer join ssd_test_map_project psm
				on psm.project_id = f.id
		order by a.project
    </select>
    <select id="dashboard.ssd_test.summary.all.1" resultType="hashmap">
		with tbl_list as (
   			select 
				sum(count(sm.ITEM_CODE)) over() tot, 
				project.id as project ,			
				count(*) project_tot,
				count(case 
					when r.item_code is null then 1 else null end
				) as BLANK, 
				count(case 
						when r.item_code is not null and r.status is null then 1 else null 
					end
				) as "NULL", 
	      		count(case 
						when r.status = 'Stopped' then 1 else null 
					end
				) as Stopped ,
				count(case 
						when r.status = 'Abort' then 1 else null 
					end
				)  as Abort,
				count(case 
						when r.status = 'Fail' then 1 else null 
					end
				) as Fail,
				count(case 
						when r.status = 'Breakdown' then 1 else null 
					end
				) as Breakdown,
				count(case 
						when r.status = 'Running' then 1 else null 
					end
				)  as Running ,
				count(case 
						when r.status = 'Success' then 1 else null 
					end
				) as Success ,
				count(case 
						when r.status = 'Skipped' then 1 else null 
					end
				) as Skipped
			
			from regression_stat_meta project  
			left outer join ssd_test_map_project psm
				on psm.project_id = project.id
			left outer join ssd_test_set ts
				on ts.TEST_SET_IDX = psm.TEST_SET			
			left outer join SSD_TEST_SET_DTL sm
				on sm.TEST_SET_IDX = ts.TEST_SET_IDX
			left outer join  regression_stat_meta_detail r
				on r.meta_id = project.id		
				and r.item_code = sm.item_code			 
			where  1=1
			and project.id is not null
			--and project.ID in ('PJT_00064243_xxxxx.20180529_119','PJT_00064243_xxxxx.20180529_123')
			group by project.id
		) 

		select
			   COUNT(*) OVER() AS tot_cnt
			, f.PJT_CODE 
			, a.project
			, f.PROJECT_NAME
			, ts.TEST_SET_IDX 
			, ts.TEST_SET
			, f.GENERATED
			, f.STARTED
			, f.FINISHED
			, FW_MATURITY
			, PROJECT_TYPE
			, CATEGORY
			, PRODUCT
			, NAND_TECH
			, NAND_REVISION
			, CONTROLLER_REVISION
			, FORM_FACTOR
			, DENSITY
			, CUSTOMER
			, DEPOT
			, FW_REVISION
			, FW_BINARY
			, LINK
			, DESCRIPTION
			
			
			
			, a.project_tot		
			, a.Success
			, case a.project_tot when 0 then 0 else a.Success/a.project_tot end as Success_RATIO	
			, a.Fail
			, case a.project_tot when 0 then 0 else a.Fail/a.project_tot end as Fail_RATIO
			, a."NULL"
			, case a.project_tot when 0 then 0 else a."NULL"/a.project_tot end as Null_RATIO
			, a.Stopped
			, case a.project_tot when 0 then 0 else a.Stopped/a.project_tot end as Stopped_RATIO
			, a.Abort
			, case a.project_tot when 0 then 0 else a.Abort/a.project_tot end as Abort_RATIO			
			, a.Breakdown
			, case a.project_tot when 0 then 0 else a.Breakdown/a.project_tot end as Breakdown_RATIO
			, a.Running
			, case a.project_tot when 0 then 0 else a.Running/a.project_tot end as Running_RATIO
			
			, a.Skipped
			, case a.project_tot when 0 then 0 else a.Skipped/a.project_tot end as Skipped_RATIO
			, a.Blank
			, case a.project_tot when 0 then 0 else a.Blank/a.project_tot end as Blank_RATIO
			
		from tbl_list a
		left outer join REGRESSION_STAT_META f
			on f.id = a.project
		left outer join ssd_test_map_project psm
				on psm.project_id = f.id
		left outer join ssd_test_set ts
			on ts.TEST_SET_IDX = psm.TEST_SET
		order by a.project
    </select>
    <update id="dashbaord.ssd_test.regression_stat.temp.item_code" parameterType="hashmap">
	    declare
			v_cnt number;
			v_item_code varchar2(100);
			
		begin
			for rec in (
				select * from REGRESSION_STAT_META_DETAIL
			) loop 
				if rec.item_code is null then
					
					SELECT  item_code 
						into v_item_code
					FROM   (
		    			SELECT * FROM   (
		    				select rownum as rnum, a.* 
		 					from (
		  						select sm.ITEM_CODE , max(sm.REV) rev from SSD_TEST_MASTER sm group by sm.item_code
		 					) a  
		    			)
		    			ORDER BY DBMS_RANDOM.VALUE
		    		)
					WHERE  rownum = 1;
					
					select count(*) into v_cnt from REGRESSION_STAT_META_DETAIL
					where META_ID = rec.META_ID
					and item_code = v_item_code ;
					
					if v_cnt = 0 then					
						update REGRESSION_STAT_META_DETAIL set
							item_code = v_item_code ,
							mod_dt = sysdate
						where META_ID = rec.META_ID
						and TC_ID = rec.TC_ID;
					end if;
				
				end if;
			
			end loop;
		
		end;
    </update>
    
    <select id="dashboard.ssd_test.detail.paging" resultType="hashmap">
    	Select 
			*		
		From 
		(
			select
				A.*, ROWNUM AS ROW_NUM
			from 
			(
		    	select 
		    		r.meta_id,
		    		r.tc_id,
					project.PJT_CODE ,
					project.PROJECT_ID ,
					project.PROJECT_NAME ,
					sm.item_code ,
					r.CATEGORY1, 
					r.CATEGORY2,
					r.START_TIME , 
					r.DURATION,
					nvl(r.STATUS,'Blank') as status, 
					r.COMMENTARY, 
					r.ERROR_MESSAGE,
					r.PARAMETERS				
				
				
				from regression_stat_meta project  
				left outer join ssd_test_map_project psm
					on psm.project_id = project.id
				left outer join ssd_test_set ts
					on ts.TEST_SET_IDX = psm.TEST_SET			
				left outer join SSD_TEST_SET_DTL sm
					on sm.TEST_SET_IDX = ts.TEST_SET_IDX
				left outer join  regression_stat_meta_detail r
					on r.meta_id = project.id		
					and r.item_code = sm.item_code			 
				
				where  1=1
				and project.id = #{search_project}
				<if test="search_prop != null and search_prop != '' " >
					<choose>
						<when test="search_prop == 'Project_tot'  "></when>
						<when test="search_prop == 'Null'  ">and r.item_code is not null and r.STATUS is null</when>
						<when test="search_prop == 'Blank'  ">and r.item_code is null </when>
						<otherwise> and r.STATUS = #{search_prop} </otherwise>
					</choose>					
					
				</if>	
				order by sm.item_code
			) A
			where 1=1 
	   		
		) A
		where
    	<![CDATA[
	    	A.row_num >  to_number(#{rows}) * (to_number(#{page}) -1) 
	    	and A.row_num <= to_number(#{rows}) * to_number(#{page})
    	]]>	
		
    </select>
    <select id="dashboard.ssd_test.detail.paging.page" resultType="hashmap">
    	select 
				ceil(count(*)/ #{rows} ) as total,
				#{page} as page ,
				count(*) records 
			from 
			(
				select a.* from (
		    		select 
					project.PJT_CODE ,
					project.PROJECT_ID ,
					project.PROJECT_NAME ,
					sm.item_code ,
					r.CATEGORY1, 
					r.CATEGORY2,
					r.START_TIME , 
					r.DURATION,
					r.STATUS, 
					r.COMMENTARY, 
					r.ERROR_MESSAGE,
					r.PARAMETERS				
				
				
				from regression_stat_meta project  
				left outer join ssd_test_map_project psm
					on psm.project_id = project.id
				left outer join ssd_test_set ts
					on ts.TEST_SET_IDX = psm.TEST_SET			
				left outer join SSD_TEST_SET_DTL sm
					on sm.TEST_SET_IDX = ts.TEST_SET_IDX
				left outer join  regression_stat_meta_detail r
					on r.meta_id = project.id		
					and r.item_code = sm.item_code			 
				
				where  1=1
				and project.id = #{search_project}
				<if test="search_prop != null and search_prop != '' " >
					<choose>
						<when test="search_prop == 'Project_tot'  "></when>
						<when test="search_prop == 'Null'  ">and r.item_code is not null and r.STATUS is null</when>
						<when test="search_prop == 'Blank'  ">and r.item_code is null </when>
						<otherwise> and r.STATUS = #{search_prop} </otherwise>
					</choose>					
					
				</if>
					
			) A
			where 1=1 
			
		)
		
		
    </select>
    <update id="dashboard.ssd_test.regression.detail.status.update" parameterType="hashmap">
    	declare
	    	cnt number;
	    	
	    begin
	    		
	    		select count(*) into cnt from REGRESSION_STAT_META_DETAIL
	    		where META_ID = #{detail.META_ID}
                and  TC_ID = #{detail.TC_ID};
	    		
	    		update REGRESSION_STAT_META_DETAIL set
	    			status = #{detail.STATUS},
	    			mod_dt = sysdate
	    		where META_ID = #{detail.META_ID}
                and  TC_ID = #{detail.TC_ID}; 
	    		
	    		
                
       	 
	    end;
    
    </update>
    
    
</mapper>    